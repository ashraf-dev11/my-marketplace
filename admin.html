<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f5f7fa; }
        .sidebar { background: linear-gradient(180deg, #1e3a8a 0%, #3b82f6 100%); }
    </style>
</head>
<body class="font-cairo">
    
    <!-- ğŸ” ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-shield text-white text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</h1>
                <p class="text-gray-600">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</p>
            </div>
            
            <form id="adminLoginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="adminEmail" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="adminPassword" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                </button>
            </form>
            
            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-sm text-yellow-800 text-center">
                    <i class="fas fa-exclamation-triangle ml-1"></i>
                    Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø·
                </p>
            </div>
        </div>
    </div>
    
    <!-- ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="dashboard" class="hidden">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <nav class="bg-white shadow-lg py-4 px-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-crown text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</h1>
                        <p class="text-sm text-gray-600" id="adminEmailDisplay"></p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="logoutAdmin()" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200">
                        <i class="fas fa-sign-out-alt ml-2"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="flex">
            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
            <div class="sidebar w-64 min-h-screen text-white p-6">
                <nav class="space-y-2 mt-8">
                    <a href="#" onclick="showSection('products')" class="block p-3 rounded-lg bg-blue-800">
                        <i class="fas fa-box ml-2"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </a>
                    <a href="#" onclick="showSection('stores')" class="block p-3 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-store ml-2"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±
                    </a>
                    <a href="#" onclick="showSection('users')" class="block p-3 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-users ml-2"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    </a>
                </nav>
            </div>
            
            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
            <div class="flex-1 p-8">
                <div id="contentArea">
                    <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-dark">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button onclick="closeModal('addProductModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="addProductForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <input type="text" id="productName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„ÙØ¦Ø©</label>
                        <select id="productCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                            <option value="electronics">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                            <option value="clothing">Ù…Ù„Ø§Ø¨Ø³</option>
                            <option value="home">Ù…Ù†Ø²Ù„ÙŠØ©</option>
                            <option value="books">ÙƒØªØ¨</option>
                            <option value="sports">Ø±ÙŠØ§Ø¶ÙŠØ©</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± ($)</label>
                        <input type="number" step="0.01" id="productPrice" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ ($)</label>
                        <input type="number" step="0.01" id="productOriginalPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                        <textarea id="productDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <select id="productSource" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                            <option value="amazon">Ø£Ù…Ø§Ø²ÙˆÙ†</option>
                            <option value="local">Ù…Ø­Ù„ÙŠ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="url" id="productLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>
                <div class="mt-8 flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="closeModal('addProductModal')" class="px-6 py-2 border border-gray-300 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus ml-2"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50"></div>

    <script>
        // ğŸ”¥ ØªÙƒÙˆÙŠÙ† Firebase - Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§Øª index.html
        const firebaseConfig = {
            apiKey: "AIzaSyBVrMvnMoKDcP_BBa9umCXXG2T3nQcwc9Q",
            authDomain: "my-platform-7fe2a.firebaseapp.com",
            projectId: "my-platform-7fe2a",
            storageBucket: "my-platform-7fe2a.firebasestorage.app",
            messagingSenderId: "942843794284",
            appId: "1:942843794284:web:c36e851cd04301ca985949"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let auth, db;
        
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Firebase:", error);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                loginAdmin();
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addProduct();
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
            const savedEmail = localStorage.getItem('adminEmail');
            if (savedEmail) {
                document.getElementById('adminEmail').value = savedEmail;
            }
        });

        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
        async function loginAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            try {
                showToast('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙÙŠ localStorage
                localStorage.setItem('adminEmail', email);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showDashboard(user);
            } catch (error) {
                showToast(getFirebaseErrorMessage(error.code), 'error');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
        function logoutAdmin() {
            auth.signOut().then(() => {
                localStorage.removeItem('adminEmail');
                location.reload();
            });
        }

        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function showDashboard(user) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('adminEmailDisplay').textContent = user.email;
            showSection('products');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        function showSection(section) {
            const contentArea = document.getElementById('contentArea');
            
            switch(section) {
                case 'products':
                    contentArea.innerHTML = `
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-3xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                                <button onclick="showAddProductModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-plus ml-2"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                                </button>
                            </div>
                            <div class="bg-white rounded-xl shadow overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="text-right py-3 px-4">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                            <th class="text-right py-3 px-4">Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th class="text-right py-3 px-4">Ø§Ù„Ù…ØµØ¯Ø±</th>
                                            <th class="text-right py-3 px-4">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                                            <th class="text-right py-3 px-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th class="text-right py-3 px-4">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsTable">
                                        <tr>
                                            <td colspan="6" class="text-center py-8">
                                                <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                                                <p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    loadProductsForAdmin();
                    break;
                    
                case 'stores':
                    contentArea.innerHTML = `
                        <div class="mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±</h2>
                            <div id="storesList" class="space-y-4">
                                <div class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                                    <p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±...</p>
                                </div>
                            </div>
                        </div>
                    `;
                    loadStoresForAdmin();
                    break;
                    
                case 'users':
                    contentArea.innerHTML = `
                        <div class="mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                            <div id="usersList" class="space-y-4">
                                <div class="text-center py-8">
                                    <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                                    <p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</p>
                                </div>
                            </div>
                        </div>
                    `;
                    loadUsersForAdmin();
                    break;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
        async function loadProductsForAdmin() {
            const productsTable = document.getElementById('productsTable');
            
            try {
                const querySnapshot = await db.collection('products').orderBy('createdAt', 'desc').get();
                
                if (querySnapshot.empty) {
                    productsTable.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-500">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let productsHTML = '';
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    const productId = doc.id;
                    const date = product.createdAt ? product.createdAt.toDate().toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    const expectedProfit = product.price * 0.2;
                    
                    productsHTML += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="py-4 px-4">
                                <div class="flex items-center">
                                    <div class="ml-3">
                                        <p class="font-semibold text-dark">${product.name}</p>
                                        <p class="text-sm text-gray-500">${product.category}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="py-4 px-4">
                                <span class="font-bold text-primary">$${product.price}</span>
                                ${product.originalPrice ? 
                                    `<br><span class="text-sm text-gray-500 line-through">$${product.originalPrice}</span>` : 
                                    ''
                                }
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-3 py-1 rounded-full text-sm ${product.source === 'amazon' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                                    ${product.source === 'amazon' ? 'Ø£Ù…Ø§Ø²ÙˆÙ†' : 'Ù…Ø­Ù„ÙŠ'}
                                </span>
                            </td>
                            <td class="py-4 px-4">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-600">$${expectedProfit.toFixed(2)}</div>
                                    <div class="text-xs text-gray-500">Ø±Ø¨Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
                                </div>
                            </td>
                            <td class="py-4 px-4 text-gray-600">${date}</td>
                            <td class="py-4 px-4">
                                <div class="flex space-x-2 space-x-reverse">
                                    <button onclick="editProductPrompt('${productId}')" class="text-blue-600 hover:text-blue-800 p-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteProduct('${productId}')" class="text-red-600 hover:text-red-800 p-2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                productsTable.innerHTML = productsHTML;
            } catch (error) {
                console.error('Error loading products:', error);
                productsTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-red-500">
                            Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </td>
                    </tr>
                `;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø± Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
        async function loadStoresForAdmin() {
            const storesList = document.getElementById('storesList');
            
            try {
                const querySnapshot = await db.collection('stores').orderBy('createdAt', 'desc').get();
                
                if (querySnapshot.empty) {
                    storesList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ§Ø¬Ø± Ø¨Ø¹Ø¯
                        </div>
                    `;
                    return;
                }
                
                let storesHTML = '';
                querySnapshot.forEach(doc => {
                    const store = doc.data();
                    const storeId = doc.id;
                    const date = store.createdAt ? store.createdAt.toDate().toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    
                    storesHTML += `
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-xl font-bold text-dark mb-2">${store.name}</h3>
                                    <p class="text-gray-600 mb-2">${store.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                                    <div class="flex items-center text-gray-500 text-sm">
                                        <i class="fas fa-user ml-1"></i>
                                        <span>${store.ownerName}</span>
                                        <i class="fas fa-calendar mr-3 ml-4"></i>
                                        <span>${date}</span>
                                    </div>
                                </div>
                                <div class="flex space-x-2 space-x-reverse">
                                    <button onclick="deleteStore('${storeId}')" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex space-x-6 space-x-reverse mt-4 text-center">
                                <div>
                                    <div class="text-lg font-bold text-primary">${store.productsCount || 0}</div>
                                    <div class="text-sm text-gray-500">Ù…Ù†ØªØ¬</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-secondary">${store.salesCount || 0}</div>
                                    <div class="text-sm text-gray-500">Ù…Ø¨ÙŠØ¹</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                storesList.innerHTML = storesHTML;
            } catch (error) {
                console.error('Error loading stores:', error);
                storesList.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±
                    </div>
                `;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
        async function loadUsersForAdmin() {
            const usersList = document.getElementById('usersList');
            
            try {
                const querySnapshot = await db.collection('users').orderBy('createdAt', 'desc').get();
                
                if (querySnapshot.empty) {
                    usersList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯
                        </div>
                    `;
                    return;
                }
                
                let usersHTML = '';
                querySnapshot.forEach(doc => {
                    const user = doc.data();
                    const userId = doc.id;
                    const date = user.createdAt ? user.createdAt.toDate().toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    
                    usersHTML += `
                        <div class="bg-white p-6 rounded-xl shadow border">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-bold text-dark mb-1">${user.name}</h3>
                                    <p class="text-gray-600">${user.email}</p>
                                    <div class="flex items-center text-gray-500 text-sm mt-2">
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded">${user.role || 'Ø¨Ø§Ø¦Ø¹'}</span>
                                        <i class="fas fa-calendar mr-3 ml-4"></i>
                                        <span>${date}</span>
                                    </div>
                                    <div class="mt-3 text-sm">
                                        <span class="text-gray-600">Ø§Ù„Ù…ØªØ§Ø¬Ø±: ${user.storesCount || 0}</span>
                                        <span class="mr-4 ml-4">|</span>
                                        <span class="text-gray-600">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${user.totalSales || 0}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                usersList.innerHTML = usersHTML;
            } catch (error) {
                console.error('Error loading users:', error);
                usersList.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    </div>
                `;
            }
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
            document.getElementById('addProductModal').classList.add('flex');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
        async function addProduct() {
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const originalPrice = document.getElementById('productOriginalPrice').value ? 
                parseFloat(document.getElementById('productOriginalPrice').value) : null;
            const description = document.getElementById('productDescription').value;
            const source = document.getElementById('productSource').value;
            const link = document.getElementById('productLink').value;
            
            if (!name || !price) {
                showToast('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            try {
                showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬...');
                
                await db.collection('products').add({
                    name: name,
                    category: category,
                    price: price,
                    originalPrice: originalPrice,
                    description: description,
                    source: source,
                    link: link || '',
                    status: 'active',
                    addedBy: auth.currentUser.uid,
                    addedByRole: 'admin',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    profitMargin: 0.2,
                    adminProfit: price * 0.05,
                    expectedSellerProfit: price * 0.2
                });
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeModal('addProductModal');
                document.getElementById('addProductForm').reset();
                loadProductsForAdmin();
                
            } catch (error) {
                console.error('Error adding product:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        }

        // Ø­Ø°Ù Ù…Ù†ØªØ¬
        async function deleteProduct(productId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
                return;
            }
            
            try {
                showToast('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬...');
                
                await db.collection('products').doc(productId).update({
                    status: 'deleted',
                    deletedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    deletedBy: auth.currentUser.uid
                });
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadProductsForAdmin();
                
            } catch (error) {
                console.error('Error deleting product:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        }

        // Ø­Ø°Ù Ù…ØªØ¬Ø±
        async function deleteStore(storeId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŸ')) {
                try {
                    await db.collection('stores').doc(storeId).delete();
                    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØªØ¬Ø±', 'success');
                    loadStoresForAdmin();
                } catch (error) {
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ØªØ¬Ø±', 'error');
                }
            }
        }

        // ØªØ­Ø±ÙŠØ± Ù…Ù†ØªØ¬
        async function editProductPrompt(productId) {
            try {
                const productDoc = await db.collection('products').doc(productId).get();
                const product = productDoc.data();
                
                const editHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-xl max-w-2xl w-full p-8">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-dark">ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬</h3>
                                <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-2xl"></i>
                                </button>
                            </div>
                            <form id="editProductForm">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                                        <input type="text" id="editProductName" value="${product.name}" 
                                               class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø³Ø¹Ø± ($)</label>
                                        <input type="number" step="0.01" id="editProductPrice" value="${product.price}" 
                                               class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                                        <textarea id="editProductDescription" rows="3" 
                                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg">${product.description || ''}</textarea>
                                    </div>
                                </div>
                                <div class="mt-8 flex justify-end space-x-4 space-x-reverse">
                                    <button type="button" onclick="closeEditModal()" 
                                            class="px-6 py-2 border border-gray-300 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button type="submit" 
                                            class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                        Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                
                const editElement = document.createElement('div');
                editElement.innerHTML = editHTML;
                editElement.id = 'editProductModal';
                document.body.appendChild(editElement);
                
                document.getElementById('editProductForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await updateProduct(productId);
                });
                
            } catch (error) {
                console.error('Error loading product for edit:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        }

        async function updateProduct(productId) {
            const name = document.getElementById('editProductName').value;
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const description = document.getElementById('editProductDescription').value;
            
            try {
                showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬...');
                
                await db.collection('products').doc(productId).update({
                    name: name,
                    price: price,
                    description: description,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    expectedSellerProfit: price * 0.2,
                    adminProfit: price * 0.05
                });
                
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeEditModal();
                loadProductsForAdmin();
                
            } catch (error) {
                console.error('Error updating product:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        }

        function closeEditModal() {
            const modal = document.getElementById('editProductModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'} text-white`;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // ØªØ±Ø¬Ù…Ø© Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Firebase
        function getFirebaseErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­',
                'auth/user-disabled': 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„',
                'auth/user-not-found': 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯',
                'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'auth/email-already-in-use': 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„',
                'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹',
                'auth/network-request-failed': 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'
            };
            return messages[errorCode] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        }
    </script>
</body>
</html>
