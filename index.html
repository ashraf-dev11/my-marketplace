<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุตุฉ ูุชุงุฌุฑ - ููุตุฉ ูุชูุงููุฉ ููุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ</title>
    <meta name="description" content="ููุตุฉ ูุชูุงููุฉ ูุฅูุดุงุก ูุชุงุฌุฑ ุฅููุชุฑูููุฉุ ุฅุฏุงุฑุฉ ุงูุจุงุฆุนููุ ููุฑุงูุจุฉ ุงููุจูุนุงุช ูุน ูุธุงู ุนูููุงุช">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6",
                        secondary: "#10B981",
                        accent: "#F59E0B",
                        premium: "#8B5CF6",
                        dark: "#1F2937",
                        light: "#F9FAFB",
                        seller: "#3B82F6",
                        buyer: "#10B981",
                        admin: "#F59E0B"
                    },
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .store-card { transition: all 0.3s ease; }
        .store-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .premium-badge { background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); }
        .seller-badge { background: #3B82F6; }
        .buyer-badge { background: #10B981; }
        .admin-badge { background: #F59E0B; }
        .loading { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        /* Hide sections by default */
        main > section { display: none; }
        #home { display: block; }
    </style>
</head>
<body class="bg-gray-50 font-cairo">
    <!-- Header Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2 space-x-reverse">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-store text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-dark">ููุตุฉ ูุชุงุฌุฑ</h1>
                </div>
                
                <div class="hidden md:flex items-center space-x-6 space-x-reverse">
                    <a href="#" class="text-dark hover:text-primary transition-colors" onclick="navigateTo('home')">ุงูุฑุฆูุณูุฉ</a>
                    <a href="#" class="text-dark hover:text-primary transition-colors" onclick="showStoresIfLoggedIn()">ุงููุชุงุฌุฑ</a>
                    <a href="#" class="text-dark hover:text-primary transition-colors" onclick="showContentBasedOnRole()">ุงูููุชุฌุงุช</a>
                    <a href="#" class="text-dark hover:text-primary transition-colors" onclick="navigateTo('plans')">ุจุงูุงุช ุงูุงุดุชุฑุงู</a>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse" id="authButtons">
                    <button onclick="showLoginModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-sign-in-alt ml-2"></i>
                        ุชุณุฌูู ุงูุฏุฎูู
                    </button>
                    <button onclick="showRegisterModal()" class="border border-primary text-primary px-6 py-2 rounded-lg hover:bg-primary hover:text-white transition-colors">
                        <i class="fas fa-user-plus ml-2"></i>
                        ุฅูุดุงุก ุญุณุงุจ
                    </button>
                </div>
                
                <button class="md:hidden text-dark" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 space-y-4">
                <a href="#" class="block text-dark hover:text-primary" onclick="navigateTo('home')">ุงูุฑุฆูุณูุฉ</a>
                <a href="#" class="block text-dark hover:text-primary" onclick="showStoresIfLoggedIn()">ุงููุชุงุฌุฑ</a>
                <a href="#" class="block text-dark hover:text-primary" onclick="showContentBasedOnRole()">ุงูููุชุฌุงุช</a>
                <a href="#" class="block text-dark hover:text-primary" onclick="navigateTo('plans')">ุจุงูุงุช ุงูุงุดุชุฑุงู</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section id="home" class="gradient-bg text-white py-20">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl md:text-5xl font-bold mb-6">ุฃูุดุฆ ูุชุฌุฑู ุงูุฅููุชุฑููู ูู ุฏูุงุฆู</h2>
                    <p class="text-xl mb-8 opacity-90">ููุตุฉ ูุชูุงููุฉ ุชูููู ูู ุฅูุดุงุก ูุชุฌุฑู ุงูุฎุงุตุ ุงุณุชูุฑุงุฏ ููุชุฌุงุช ูู ุฃูุงุฒููุ ูุฅุฏุงุฑุฉ ูุจูุนุงุชู ุจูู ุณูููุฉ</p>
                    <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse">
                        <button onclick="showRegisterModal()" class="bg-white text-primary px-8 py-3 rounded-lg text-lg font-semibold hover:bg-gray-100 transition-colors">
                            <i class="fas fa-store ml-2"></i>
                            ุงุจุฏุฃ ูุฌุงูุงู
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-dark mb-12">ูููุฒุงุช ุงูููุตุฉ</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="text-center p-6 rounded-xl bg-light border border-gray-200">
                        <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-store text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">ุฅูุดุงุก ูุชุฌุฑ ุฎุงุต</h3>
                        <p class="text-gray-600">ุฃูุดุฆ ูุชุฌุฑู ุงูุฎุงุต ุจูุงูู ุงูููุงุตูุงุช ูู ุฏูุงุฆู ูุนุฏูุฏุฉ</p>
                    </div>
                    <div class="text-center p-6 rounded-xl bg-light border border-gray-200">
                        <div class="w-16 h-16 bg-secondary rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shopping-cart text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">ุงุณุชูุฑุงุฏ ูู ุฃูุงุฒูู</h3>
                        <p class="text-gray-600">ุงุณุชูุฑุฏ ููุชุฌุงุช ูุจุงุดุฑุฉ ูู ุฃูุงุฒูู ูููุตุงุช ุงูุชุณูู ุงูุนุงูููุฉ</p>
                    </div>
                    <div class="text-center p-6 rounded-xl bg-light border border-gray-200">
                        <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-chart-line text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">ุฅุฏุงุฑุฉ ูุชุญููู</h3>
                        <p class="text-gray-600">ููุญุฉ ุชุญูู ูุชูุงููุฉ ููุชุงุจุนุฉ ุงููุจูุนุงุช ูุงูุฅุญุตุงุฆูุงุช</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stores Section -->
        <section id="stores" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-dark">ุงููุชุงุฌุฑ ุงููุดุทุฉ</h2>
                    <button onclick="showCreateStoreModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus ml-2"></i>
                        ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="storesContainer">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="mt-2 text-gray-600">ุฌุงุฑู ุชุญููู ุงููุชุงุฌุฑ...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section id="products" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-dark mb-8">ุงูููุชุฌุงุช ุงููุชุงุญุฉ</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center">
                        <div class="relative w-full md:w-96">
                            <input type="text" id="searchProducts" placeholder="ุงุจุญุซ ุนู ููุชุฌ..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg pr-10">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="productsContainer">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="mt-2 text-gray-600">ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Subscription Plans Section -->
        <section id="plans" class="py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-dark mb-12">ุจุงูุงุช ุงูุงุดุชุฑุงู</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <!-- Basic Plan -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="bg-primary text-white p-6 text-center">
                            <h3 class="text-2xl font-bold">ุงูุจุงูุฉ ุงูุฃุณุงุณูุฉ</h3>
                            <div class="mt-4">
                                <span class="text-4xl font-bold">$3</span>
                                <span class="text-lg">/ ุดูุฑ</span>
                            </div>
                        </div>
                        <div class="p-6">
                            <ul class="space-y-3 mb-8">
                                <li class="flex items-center">
                                    <i class="fas fa-check text-green-500 ml-2"></i>
                                    <span>ูุชุฌุฑ ูุงุญุฏ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-green-500 ml-2"></i>
                                    <span>ููุชุฌุงุช ุบูุฑ ูุญุฏูุฏุฉ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-green-500 ml-2"></i>
                                    <span>ุฏุนู ููู ุนุจุฑ ุงูุจุฑูุฏ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-green-500 ml-2"></i>
                                    <span>ุชูุงุฑูุฑ ูุจูุนุงุช ุฃุณุงุณูุฉ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-green-500 ml-2"></i>
                                    <span>ูุณุจุฉ ุนูููุฉ 15%</span>
                                </li>
                            </ul>
                            <button onclick="subscribeToPlan('basic')" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                ุงุฎุชุฑ ุงูุจุงูุฉ
                            </button>
                        </div>
                    </div>

                    <!-- Premium Plan -->
                    <div class="bg-white rounded-xl shadow-lg border-2 border-premium overflow-hidden relative">
                        <div class="absolute top-4 right-4">
                            <span class="premium-badge text-white px-3 py-1 rounded-full text-sm">ุงูุฃูุถู</span>
                        </div>
                        <div class="premium-badge text-white p-6 text-center">
                            <h3 class="text-2xl font-bold">ุงูุจุงูุฉ ุงููููุฒุฉ</h3>
                            <div class="mt-4">
                                <span class="text-4xl font-bold">$15</span>
                                <span class="text-lg">/ ุดูุฑ</span>
                            </div>
                        </div>
                        <div class="p-6">
                            <ul class="space-y-3 mb-8">
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span class="font-semibold">5 ูุชุงุฌุฑ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ููุชุฌุงุช ุบูุฑ ูุญุฏูุฏุฉ</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ุฏุนู ููู ููุฑู</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ุชูุงุฑูุฑ ูุชูุฏูุฉ ูุชุญูููุงุช</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ูุณุจุฉ ุนูููุฉ 10% ููุท</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ูุทุงู ูุฎุตุต (ุฏูููู)</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check text-purple-500 ml-2"></i>
                                    <span>ุงูุชุณููู ุงูุชููุงุฆู</span>
                                </li>
                            </ul>
                            <button onclick="subscribeToPlan('premium')" class="w-full premium-badge text-white py-3 rounded-lg hover:opacity-90 transition-colors">
                                ุงุฎุชุฑ ุงูุจุงูุฉ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Store (Main Platform Store) -->
        <section id="mainStore" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-dark mb-8">ูุชุฌุฑ ุงูููุตุฉ ุงูุฑุฆูุณู</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center">
                        <div class="relative w-full md:w-96">
                            <input type="text" id="searchMainStoreProducts" placeholder="ุงุจุญุซ ุนู ููุชุฌ..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg pr-10">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="mainStoreProductsContainer">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                        <p class="mt-2 text-gray-600">ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-2 space-x-reverse mb-4">
                        <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                            <i class="fas fa-store text-white text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold">ููุตุฉ ูุชุงุฌุฑ</h3>
                    </div>
                    <p class="text-gray-400">ููุตุฉ ูุชูุงููุฉ ูุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุชุงุฌุฑ ุงูุฅููุชุฑูููุฉ</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">ุฑูุงุจุท ุณุฑูุนุฉ</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white" onclick="navigateTo('home')">ุงูุฑุฆูุณูุฉ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white" onclick="showMainStoreIfLoggedIn()">ูุชุฌุฑ ุงูููุตุฉ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white" onclick="navigateTo('plans')">ุจุงูุงุช ุงูุงุดุชุฑุงู</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">ุงุชุตู ุจูุง</h4>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <i class="fas fa-envelope text-gray-400"></i>
                            <span class="text-gray-400">info@storeplatform.com</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>ยฉ 2024 ููุตุฉ ูุชุงุฌุฑ. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-dark">ุชุณุฌูู ุงูุฏุฎูู</h3>
                <button onclick="closeModal('loginModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 mb-4">
                    ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <div class="text-center">
                    <p class="text-gray-600">ุฃู</p>
                    <button type="button" onclick="loginWithGoogle()" class="w-full border border-gray-300 py-3 rounded-lg hover:bg-gray-50 mt-4">
                        <i class="fab fa-google ml-2 text-red-500"></i>
                        ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ุฌูููู
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-dark">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h3>
                <button onclick="closeModal('registerModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="registerForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ุงูุงุณู ุงููุงูู</label>
                    <input type="text" id="registerName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="email" id="registerEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="registerPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">ููุน ุงูุญุณุงุจ</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="accountType" value="seller" required class="ml-2">
                            <div class="flex-1">
                                <div class="font-semibold">ุจุงุฆุน</div>
                                <div class="text-sm text-gray-500">ูุฅูุดุงุก ูุฅุฏุงุฑุฉ ูุชุงุฌุฑ</div>
                            </div>
                            <i class="fas fa-store text-blue-500 text-xl"></i>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="accountType" value="buyer" required class="ml-2">
                            <div class="flex-1">
                                <div class="font-semibold">ูุดุชุฑู</div>
                                <div class="text-sm text-gray-500">ูุดุฑุงุก ุงูููุชุฌุงุช</div>
                            </div>
                            <i class="fas fa-shopping-cart text-green-500 text-xl"></i>
                        </label>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" required class="ml-2">
                        <span class="text-gray-700">ุฃูุงูู ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู</span>
                    </label>
                </div>
                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 mb-4">
                    ุฅูุดุงุก ุญุณุงุจ
                </button>
                <div class="text-center">
                    <p class="text-gray-600">ุฃู</p>
                    <button type="button" onclick="registerWithGoogle()" class="w-full border border-gray-300 py-3 rounded-lg hover:bg-gray-50 mt-4">
                        <i class="fab fa-google ml-2 text-red-500"></i>
                        ุงูุชุณุฌูู ุจุญุณุงุจ ุฌูููู
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-dark">ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ</h3>
                <button onclick="closeModal('accountSettingsModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="accountSettingsForm">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ุงูุงุณู ุงููุงูู</label>
                    <input type="text" id="settingsName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="email" id="settingsEmail" disabled class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">ููุน ุงูุญุณุงุจ</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="settingsAccountType" value="seller" class="ml-2">
                            <div class="flex-1">
                                <div class="font-semibold">ุจุงุฆุน</div>
                                <div class="text-sm text-gray-500">ูุฅูุดุงุก ูุฅุฏุงุฑุฉ ูุชุงุฌุฑ</div>
                            </div>
                            <i class="fas fa-store text-blue-500 text-xl"></i>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="settingsAccountType" value="buyer" class="ml-2">
                            <div class="flex-1">
                                <div class="font-semibold">ูุดุชุฑู</div>
                                <div class="text-sm text-gray-500">ูุดุฑุงุก ุงูููุชุฌุงุช</div>
                            </div>
                            <i class="fas fa-shopping-cart text-green-500 text-xl"></i>
                        </label>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ (ุงุฎุชูุงุฑู)</label>
                    <input type="password" id="settingsNewPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="settingsConfirmPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div class="flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="closeModal('accountSettingsModal')" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        ุฅูุบุงุก
                    </button>
                    <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        ุญูุธ ุงูุชุบููุฑุงุช
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Store Modal -->
    <div id="createStoreModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-dark">ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ</h3>
                <button onclick="closeModal('createStoreModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="createStoreForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2">ุงุณู ุงููุชุฌุฑ *</label>
                        <input type="text" id="storeName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ูุฆุฉ ุงููุชุฌุฑ</label>
                        <select id="storeCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="electronics">ุฅููุชุฑูููุงุช</option>
                            <option value="clothing">ููุงุจุณ</option>
                            <option value="home">ููุฒููุฉ</option>
                            <option value="books">ูุชุจ</option>
                            <option value="sports">ุฑูุงุถูุฉ</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-2">ูุตู ุงููุชุฌุฑ</label>
                        <textarea id="storeDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                    </div>
                </div>
                <div class="mt-8 flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="closeModal('createStoreModal')" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">ุฅูุบุงุก</button>
                    <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-check ml-2"></i>
                        ุฅูุดุงุก ุงููุชุฌุฑ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Store Details Modal -->
    <div id="storeDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-dark" id="storeDetailsTitle">ุชูุงุตูู ุงููุชุฌุฑ</h3>
                    <button onclick="closeModal('storeDetailsModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div id="storeDetailsContent">
                    <!-- ุณูุชู ููุคู ุฏููุงููููุงู -->
                </div>
            </div>
        </div>
    </div>

    <!-- Store Page (External Store) -->
    <div id="storePageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-dark" id="storePageTitle">ุตูุญุฉ ุงููุชุฌุฑ</h3>
                    <button onclick="closeModal('storePageModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div id="storePageContent">
                    <!-- ุณูุชู ููุคู ุฏููุงููููุงู -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-dark">ููุญุฉ ุงูุฅุฏุงุฑุฉ</h3>
                    <button onclick="closeModal('adminPanelModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div id="adminPanelContent">
                    <!-- ุณูุชู ููุคู ุฏููุงููููุงู -->
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle ml-2"></i>
            <span id="toastMessage">ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ!</span>
        </div>
    </div>

    <!-- Error Toast -->
    <div id="errorToast" class="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <div class="flex items-center">
            <i class="fas fa-exclamation-circle ml-2"></i>
            <span id="errorMessage">ุญุฏุซ ุฎุทุฃ!</span>
        </div>
    </div>

    <script>
        // ๐ฅ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVrMvnMoKDcP_BBa9umCXXG2T3nQcwc9Q",
            authDomain: "my-platform-7fe2a.firebaseapp.com",
            projectId: "my-platform-7fe2a",
            storageBucket: "my-platform-7fe2a.firebasestorage.app",
            messagingSenderId: "942843794284",
            appId: "1:942843794284:web:c36e851cd04301ca985949"
        };

        // ุชููุฆุฉ Firebase
        let auth, db;
        let currentUser = null;
        let currentUserRole = null;
        let currentUserAccountType = null;
        
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log("โ Firebase ุฌุงูุฒ ููุนูู");
        } catch (error) {
            console.error("โ ุฎุทุฃ ูู Firebase:", error);
        }

        // Navigation functions
        function navigateTo(section) {
            event.preventDefault();
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section).classList.remove('hidden');
            document.getElementById('mobileMenu').classList.add('hidden');
            
            if (section === 'mainStore' && currentUser) {
                loadMainStoreProducts();
            } else if (section === 'stores' && currentUser) {
                loadStores();
            } else if (section === 'products' && currentUser) {
                loadProducts();
            }
        }

        function showStoresIfLoggedIn() {
            event.preventDefault();
            if (!currentUser) {
                showLoginModal();
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
            } else {
                navigateTo('stores');
            }
        }

        function showMainStoreIfLoggedIn() {
            event.preventDefault();
            if (!currentUser) {
                showLoginModal();
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
            } else {
                navigateTo('mainStore');
            }
        }

        // Modal functions
        function showLoginModal() {
            closeAllModals();
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function showRegisterModal() {
            closeAllModals();
            document.getElementById('registerModal').classList.remove('hidden');
            document.getElementById('registerModal').classList.add('flex');
        }

        function showAccountSettingsModal() {
            closeAllModals();
            document.getElementById('accountSettingsModal').classList.remove('hidden');
            document.getElementById('accountSettingsModal').classList.add('flex');
            loadAccountSettings();
        }

        function showAdminPanelModal() {
            closeAllModals();
            document.getElementById('adminPanelModal').classList.remove('hidden');
            document.getElementById('adminPanelModal').classList.add('flex');
            loadAdminPanel();
        }

        function showCreateStoreModal() {
            if (!currentUser) {
                showLoginModal();
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                return;
            }
            
            if (currentUserAccountType !== 'seller') {
                showError('ูุฐู ุงูููุฒุฉ ูุชุงุญุฉ ููุท ููุจุงุฆุนูู');
                return;
            }
            
            // ุงูุชุญูู ูู ุงูุจุงูุฉ
            checkUserPlanAndCreateStore();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        function closeAllModals() {
            const modals = ['loginModal', 'registerModal', 'accountSettingsModal', 
                           'createStoreModal', 'storeDetailsModal', 'storePageModal', 'adminPanelModal'];
            modals.forEach(modalId => {
                closeModal(modalId);
            });
        }

        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        }

        // ๐ฅ Firebase Authentication Functions
        async function login(event) {
            if (event) event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                showToast('ุฌุงุฑู ุชุณุฌูู ุงูุฏุฎูู...');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    currentUserRole = userData.role || 'buyer';
                    currentUserAccountType = userData.accountType || 'buyer';
                    
                    showToast(`ูุฑุญุจุงู ${currentUser.displayName || currentUser.email}`, 'success');
                    closeModal('loginModal');
                    updateUIAfterLogin();
                    
                    // ุนุฑุถ ุงููุญุชูู ุงูููุงุณุจ ุญุณุจ ููุน ุงููุณุชุฎุฏู
                    showContentBasedOnRole();
                } else {
                    showError('ุจูุงูุงุช ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏุฉ');
                }
                
            } catch (error) {
                showError(getFirebaseErrorMessage(error.code));
            }
        }

        async function register(event) {
            if (event) event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const accountType = document.querySelector('input[name="accountType"]:checked').value;
            
            try {
                showToast('ุฌุงุฑู ุฅูุดุงุก ุงูุญุณุงุจ...');
                
                // ุฅูุดุงุก ุญุณุงุจ Firebase
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // ุชุญุฏูุซ ุงุณู ุงูุนุฑุถ
                await currentUser.updateProfile({ displayName: name });
                
                // ุชุญุฏูุฏ ุฏูุฑ ุงููุณุชุฎุฏู ุจูุงุกู ุนูู ููุน ุงูุญุณุงุจ
                let userRole = 'buyer';
                if (accountType === 'seller') {
                    userRole = 'seller';
                }
                
                // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
                await db.collection('users').doc(currentUser.uid).set({
                    name: name,
                    email: email,
                    role: userRole,
                    accountType: accountType,
                    plan: 'free',
                    createdAt: new Date().toISOString(),
                    storesCount: 0,
                    totalSales: 0,
                    totalPurchases: 0,
                    subscriptionExpiry: null,
                    maxStores: accountType === 'seller' ? 1 : 0,
                    maxProducts: 99999,
                    commissionRate: 0.15,
                    emailVerified: false,
                    isActive: true,
                    lastLogin: new Date().toISOString()
                });
                
                // ุญูุธ ุณุฌู ุงูุชุณุฌูู
                await db.collection('user_logs').add({
                    userId: currentUser.uid,
                    action: 'register',
                    timestamp: new Date().toISOString(),
                    details: {
                        accountType: accountType,
                        email: email,
                        name: name
                    }
                });
                
                showToast(`ุชู ุฅูุดุงุก ุญุณุงุจู ุจูุฌุงุญ ${name}`, 'success');
                closeModal('registerModal');
                
                updateUIAfterLogin();
                currentUserRole = userRole;
                currentUserAccountType = accountType;
                
                // ุนุฑุถ ุงููุญุชูู ุงูููุงุณุจ ุญุณุจ ููุน ุงููุณุชุฎุฏู ูุจุงุดุฑุฉ
                showContentBasedOnRole();
                
            } catch (error) {
                console.error('Registration error:', error);
                showError(getFirebaseErrorMessage(error.code));
            }
        }

        async function loginWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                showToast('ุฌุงุฑู ุชุณุฌูู ุงูุฏุฎูู...');
                const result = await auth.signInWithPopup(provider);
                currentUser = result.user;
                
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (!userDoc.exists) {
                    // ุนูุฏ ุงูุชุณุฌูู ูุฃูู ูุฑุฉ ุนุจุฑ ุฌูุฌูุ ูุณุฃู ุนู ููุน ุงูุญุณุงุจ ุจุงุณุชุฎุฏุงู ูุงูุฐุฉ ููุจุซูุฉ ุจุณูุทุฉ
                    const accountType = prompt('ุงุฎุชุฑ ููุน ุญุณุงุจู:\n1. ุจุงุฆุน (ูุฅูุดุงุก ูุฅุฏุงุฑุฉ ูุชุงุฌุฑ)\n2. ูุดุชุฑู (ูุดุฑุงุก ุงูููุชุฌุงุช)\n\nุฃุฏุฎู 1 ุฃู 2:');
                    
                    const finalAccountType = (accountType === '1') ? 'seller' : 'buyer';
                    const finalRole = (finalAccountType === 'seller') ? 'seller' : 'buyer';
                    
                    await db.collection('users').doc(currentUser.uid).set({
                        name: currentUser.displayName,
                        email: currentUser.email,
                        role: finalRole,
                        accountType: finalAccountType,
                        plan: 'free',
                        createdAt: new Date().toISOString(),
                        storesCount: 0,
                        totalSales: 0,
                        totalPurchases: 0,
                        subscriptionExpiry: null,
                        maxStores: finalAccountType === 'seller' ? 1 : 0,
                        maxProducts: 99999,
                        commissionRate: 0.15,
                        emailVerified: true,
                        isActive: true,
                        lastLogin: new Date().toISOString(),
                        googleAuth: true
                    });
                    
                    // ุญูุธ ุณุฌู ุงูุชุณุฌูู
                    await db.collection('user_logs').add({
                        userId: currentUser.uid,
                        action: 'register_google',
                        timestamp: new Date().toISOString(),
                        details: {
                            accountType: finalAccountType,
                            email: currentUser.email,
                            name: currentUser.displayName
                        }
                    });
                    
                    currentUserRole = finalRole;
                    currentUserAccountType = finalAccountType;
                } else {
                    // ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
                    const userData = userDoc.data();
                    currentUserRole = userData.role || 'buyer';
                    currentUserAccountType = userData.accountType || 'buyer';
                }
                
                showToast(`ูุฑุญุจุงู ${currentUser.displayName}`, 'success');
                closeModal('loginModal');
                updateUIAfterLogin();
                
                // ุนุฑุถ ุงููุญุชูู ุงูููุงุณุจ ุญุณุจ ููุน ุงููุณุชุฎุฏู
                showContentBasedOnRole();
                
            } catch (error) {
                showError(getFirebaseErrorMessage(error.code));
            }
        }

        function registerWithGoogle() {
            loginWithGoogle();
        }

        async function logout() {
            try {
                // ุญูุธ ุณุฌู ุชุณุฌูู ุงูุฎุฑูุฌ
                if (currentUser) {
                    await db.collection('user_logs').add({
                        userId: currentUser.uid,
                        action: 'logout',
                        timestamp: new Date().toISOString()
                    });
                }
                
                await auth.signOut();
                currentUser = null;
                currentUserRole = null;
                currentUserAccountType = null;
                showToast('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ', 'success');
                updateUIAfterLogout();
                
                // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ูุฅุธูุงุฑ ุงูุฑุฆูุณูุฉ ููุท
                showContentForGuest();
                
            } catch (error) {
                showError('ุฎุทุฃ ูู ุชุณุฌูู ุงูุฎุฑูุฌ');
            }
        }

        // ๐ฅ Firestore Functions
        async function createStore(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                showLoginModal();
                return;
            }
            
            if (currentUserAccountType !== 'seller') {
                showError('ูุฐู ุงูููุฒุฉ ูุชุงุญุฉ ููุท ููุจุงุฆุนูู');
                return;
            }
            
            const storeName = document.getElementById('storeName').value;
            const storeCategory = document.getElementById('storeCategory').value;
            const storeDescription = document.getElementById('storeDescription').value;
            
            try {
                showToast('ุฌุงุฑู ุฅูุดุงุก ุงููุชุฌุฑ...');
                
                // ุฅูุดุงุก ุฑุงุจุท ูุฑูุฏ ูููุชุฌุฑ
                const storeSlug = generateStoreSlug(storeName);
                const storeUrl = `${window.location.origin}/store/${storeSlug}`;
                
                const storeData = {
                    name: storeName,
                    category: storeCategory,
                    description: storeDescription,
                    ownerId: currentUser.uid,
                    ownerName: currentUser.displayName || currentUser.email.split('@')[0],
                    ownerEmail: currentUser.email,
                    createdAt: new Date().toISOString(),
                    productsCount: 0,
                    salesCount: 0,
                    totalRevenue: 0,
                    rating: 0,
                    status: 'active',
                    storeSlug: storeSlug,
                    storeUrl: storeUrl,
                    lastUpdated: new Date().toISOString(),
                    isActive: true,
                    plan: 'free'
                };
                
                const storeRef = await db.collection('stores').add(storeData);
                const storeId = storeRef.id;
                
                // ุชุญุฏูุซ ุงููุชุฌุฑ ุจุงูู ID
                await db.collection('stores').doc(storeId).update({
                    id: storeId
                });
                
                await db.collection('users').doc(currentUser.uid).update({
                    storesCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // ุญูุธ ุณุฌู ุฅูุดุงุก ุงููุชุฌุฑ
                await db.collection('store_logs').add({
                    storeId: storeId,
                    action: 'create',
                    userId: currentUser.uid,
                    timestamp: new Date().toISOString(),
                    details: {
                        name: storeName,
                        category: storeCategory
                    }
                });
                
                showToast('ุชู ุฅูุดุงุก ุงููุชุฌุฑ ุจูุฌุงุญ', 'success');
                
                // ุฅุบูุงู ูุงูุฐุฉ ุฅูุดุงุก ุงููุชุฌุฑ
                closeModal('createStoreModal');
                
                // ุฅุบูุงู ููุญุฉ ุงูุชุญูู ุฅุฐุง ูุงูุช ููุชูุญุฉ
                closeUserDashboard();
                
                // ูุชุญ ุชูุงุตูู ุงููุชุฌุฑ ุงูุฌุฏูุฏ
                setTimeout(() => {
                    showStoreDetailsModal(storeId);
                }, 500);
                
                // ุชุญุฏูุซ ูุงุฆูุฉ ุงููุชุงุฌุฑ
                loadStores();
                
            } catch (error) {
                console.error('Error creating store:', error);
                showError('ุฎุทุฃ ูู ุฅูุดุงุก ุงููุชุฌุฑ: ' + error.message);
            }
        }

        async function loadStores() {
            const container = document.getElementById('storesContainer');
            
            try {
                const querySnapshot = await db.collection('stores')
                    .where('isActive', '==', true)
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();
                
                if (querySnapshot.empty) {
                    container.innerHTML = `
                        <div class="md:col-span-3 text-center py-12">
                            <i class="fas fa-store text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">ูุง ุชูุฌุฏ ูุชุงุฌุฑ ูุดุทุฉ</p>
                            ${currentUser && currentUserAccountType === 'seller' ? `
                                <button onclick="showCreateStoreModal()" class="mt-4 bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                    ุฃูุดุฆ ุฃูู ูุชุฌุฑ ูู
                                </button>
                            ` : ''}
                        </div>
                    `;
                    return;
                }
                
                let storesHTML = '';
                querySnapshot.forEach(doc => {
                    const store = doc.data();
                    const storeId = doc.id;
                    
                    storesHTML += `
                        <div class="store-card bg-white rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-3">
                                    <h3 class="text-xl font-bold text-dark">${store.name || 'ูุชุฌุฑ ุจุฏูู ุงุณู'}</h3>
                                    <span class="bg-primary text-white text-sm px-3 py-1 rounded-full">${getCategoryName(store.category)}</span>
                                </div>
                                <p class="text-gray-600 mb-4">${store.description || 'ูุง ููุฌุฏ ูุตู'}</p>
                                <div class="flex items-center text-gray-500 mb-4">
                                    <i class="fas fa-user ml-2"></i>
                                    <span>${store.ownerName || 'ูุงูู ุบูุฑ ูุนุฑูู'}</span>
                                </div>
                                <div class="flex justify-between items-center mb-4">
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-primary">${store.productsCount || 0}</div>
                                        <div class="text-sm text-gray-500">ููุชุฌ</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-secondary">${store.salesCount || 0}</div>
                                        <div class="text-sm text-gray-500">ูุจูุน</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-accent">${store.rating || 0}</div>
                                        <div class="text-sm text-gray-500">ุชูููู</div>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <button onclick="showStorePage('${storeId}')" 
                                           class="w-full bg-primary text-white py-2 rounded-lg hover:bg-blue-700 transition-colors text-center">
                                        <i class="fas fa-external-link-alt ml-2"></i>
                                        ุฒูุงุฑุฉ ุงููุชุฌุฑ
                                    </button>
                                    ${currentUser && currentUser.uid === store.ownerId ? `
                                        <button onclick="showStoreDetailsModal('${storeId}')" 
                                                class="w-full border border-primary text-primary py-2 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                            <i class="fas fa-chart-bar ml-2"></i>
                                            ุชูุงุตูู ุงููุชุฌุฑ
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = storesHTML;
            } catch (error) {
                console.error('Error loading stores:', error);
                container.innerHTML = `
                    <div class="md:col-span-3 text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-gray-500">ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงููุชุงุฌุฑ</p>
                    </div>
                `;
            }
        }

        async function loadProducts() {
            const container = document.getElementById('productsContainer');
            
            try {
                const querySnapshot = await db.collection('products')
                    .where('status', '==', 'active')
                    .limit(12)
                    .get();
                
                if (querySnapshot.empty) {
                    container.innerHTML = `
                        <div class="md:col-span-4 text-center py-12">
                            <i class="fas fa-box text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">ูุง ุชูุฌุฏ ููุชุฌุงุช ูุชุงุญุฉ ุญุงููุงู</p>
                            ${currentUser && currentUserAccountType === 'seller' ? `
                                <button onclick="addSampleProducts()" class="mt-4 bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                    ุฅุถุงูุฉ ููุชุฌุงุช ุชุฌุฑูุจูุฉ
                                </button>
                            ` : ''}
                        </div>
                    `;
                    return;
                }
                
                let productsHTML = '';
                
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    const productId = doc.id;
                    
                    const price = Number(product.price) || 0;
                    const originalPrice = Number(product.originalPrice) || price * 1.2;
                    const expectedProfit = price * 0.2;
                    
                    productsHTML += `
                        <div class="store-card bg-white rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6">
                                <h3 class="text-xl font-bold text-dark mb-2">${product.name}</h3>
                                <p class="text-gray-600 text-sm mb-4">${product.description || 'ููุชุฌ ุนุงูู ุงูุฌูุฏุฉ'}</p>
                                
                                <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700">ุงูุณุนุฑ:</span>
                                        <div class="text-right">
                                            <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                            <span class="text-sm text-gray-500 line-through mr-2 block">$${originalPrice.toFixed(2)}</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center mt-3">
                                        <span class="text-gray-700">ุงูุฑุจุญ ุงููุชููุน:</span>
                                        <span class="text-lg font-bold text-green-600">+$${expectedProfit.toFixed(2)}</span>
                                    </div>
                                </div>
                                
                                ${currentUser && currentUserAccountType === 'seller' ? `
                                    <button onclick="addToStore('${productId}')" 
                                            class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-plus ml-2"></i>
                                        ุฃุถู ููุชุฌุฑู
                                    </button>
                                ` : `
                                    <button onclick="showLoginModal()" 
                                            class="w-full border border-primary text-primary py-3 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                        <i class="fas fa-sign-in-alt ml-2"></i>
                                        ุณุฌู ุงูุฏุฎูู ููุฅุถุงูุฉ
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = productsHTML;
            } catch (error) {
                console.error('Error loading products:', error);
                container.innerHTML = `
                    <div class="md:col-span-4 text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-gray-500">ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูููุชุฌุงุช</p>
                    </div>
                `;
            }
        }

        async function addSampleProducts() {
            try {
                const sampleProducts = [
                    {
                        name: "ุณูุงุนุงุช ูุงุณูููุฉ",
                        description: "ุณูุงุนุงุช ุจููุชูุซ ุนุงููุฉ ุงูุฌูุฏุฉ ูุน ุฅูุบุงุก ุงูุถูุถุงุก",
                        price: 49.99,
                        originalPrice: 69.99,
                        category: "electronics",
                        status: "active",
                        stock: 50,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: "ุณุงุนุฉ ุฐููุฉ",
                        description: "ุณุงุนุฉ ุฐููุฉ ุจุชูููุงุช ูุชุทูุฑุฉ ูุชุชุจุน ุงูุตุญุฉ",
                        price: 199.99,
                        originalPrice: 249.99,
                        category: "electronics",
                        status: "active",
                        stock: 30,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: "ุญููุจุฉ ูุงุจุชูุจ",
                        description: "ุญููุจุฉ ููุงููุฉ ูููุงุก ููููุจููุชุฑ ุงููุญููู",
                        price: 29.99,
                        originalPrice: 39.99,
                        category: "clothing",
                        status: "active",
                        stock: 100,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: "ูุงูุณ ูุงุณููู",
                        description: "ูุงูุณ ูุงุณููู ุฏููู ูุณุฑูุน ุงูุงุณุชุฌุงุจุฉ",
                        price: 19.99,
                        originalPrice: 29.99,
                        category: "electronics",
                        status: "active",
                        stock: 75,
                        createdAt: new Date().toISOString()
                    }
                ];
                
                const batch = db.batch();
                sampleProducts.forEach(product => {
                    const docRef = db.collection('products').doc();
                    batch.set(docRef, product);
                });
                
                await batch.commit();
                showToast('ุชู ุฅุถุงูุฉ ุงูููุชุฌุงุช ุงูุชุฌุฑูุจูุฉ ุจูุฌุงุญ', 'success');
                loadProducts();
                
            } catch (error) {
                console.error('Error adding sample products:', error);
                showError('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุชุฌุงุช ุงูุชุฌุฑูุจูุฉ');
            }
        }

        async function addToStore(productId) {
            if (!currentUser) {
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                showLoginModal();
                return;
            }
            
            if (currentUserAccountType !== 'seller') {
                showError('ูุฐู ุงูููุฒุฉ ูุชุงุญุฉ ููุท ููุจุงุฆุนูู');
                return;
            }
            
            try {
                showToast('ุฌุงุฑู ุฅุถุงูุฉ ุงูููุชุฌ ูููุชุฌุฑ...');
                
                // ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                // ุฌูุจ ูุชุงุฌุฑ ุงููุณุชุฎุฏู
                const userStores = await db.collection('stores')
                    .where('ownerId', '==', currentUser.uid)
                    .where('isActive', '==', true)
                    .get();
                
                if (userStores.empty) {
                    showError('ููุณ ูุฏูู ูุชุงุฌุฑ ูุดุทุฉุ ุฃูุดุฆ ูุชุฌุฑ ุฃููุงู');
                    showCreateStoreModal();
                    return;
                }
                
                const storeDoc = userStores.docs[0];
                const storeId = storeDoc.id;
                const storeData = storeDoc.data();
                
                // ุฌูุจ ุจูุงูุงุช ุงูููุชุฌ
                const productDoc = await db.collection('products').doc(productId).get();
                
                if (!productDoc.exists) {
                    showError('ุงูููุชุฌ ุบูุฑ ููุฌูุฏ');
                    return;
                }
                
                const productData = productDoc.data();
                
                // ุฅุถุงูุฉ ุงูููุชุฌ ูููุชุฌุฑ
                await db.collection('store_products').add({
                    storeId: storeId,
                    productId: productId,
                    productName: productData.name,
                    productPrice: productData.price,
                    productDescription: productData.description,
                    addedBy: currentUser.uid,
                    addedAt: new Date().toISOString(),
                    status: 'active',
                    customPrice: productData.price,
                    profitMargin: userData.commissionRate || 0.2,
                    expectedProfit: productData.price * (userData.commissionRate || 0.2)
                });
                
                // ุชุญุฏูุซ ุนุฏุฏ ููุชุฌุงุช ุงููุชุฌุฑ
                await db.collection('stores').doc(storeId).update({
                    productsCount: firebase.firestore.FieldValue.increment(1),
                    lastUpdated: new Date().toISOString()
                });
                
                showToast('ุชู ุฅุถุงูุฉ ุงูููุชุฌ ูููุชุฌุฑ ุจูุฌุงุญ!', 'success');
                
                const profit = productData.price * (userData.commissionRate || 0.2);
                setTimeout(() => {
                    showToast(`ุงูุฑุจุญ ุงููุชููุน ููู ุจูุน: $${profit.toFixed(2)}`, 'success');
                }, 1500);
                
            } catch (error) {
                console.error('Error adding product to store:', error);
                showError('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูููุชุฌ ูููุชุฌุฑ: ' + error.message);
            }
        }

        async function loadMainStoreProducts() {
            const container = document.getElementById('mainStoreProductsContainer');
            
            try {
                // ููุชุฌุงุช ุงููุชุฌุฑ ุงูุฑุฆูุณู ููููุตุฉ
                const querySnapshot = await db.collection('main_store_products')
                    .where('status', '==', 'active')
                    .limit(12)
                    .get();
                
                if (querySnapshot.empty) {
                    // ุฅุถุงูุฉ ุจุนุถ ุงูููุชุฌุงุช ุงูุงูุชุฑุงุถูุฉ ูููุชุฌุฑ ุงูุฑุฆูุณู
                    const defaultProducts = [
                        {
                            name: "ูุงุจุชูุจ ุฏูู XPS 13",
                            description: "ูุงุจุชูุจ ุฏูู XPS 13 ุจุดุงุดุฉ ููุณ ูุจุทุงุฑูุฉ ุชุฏูู ุทูููุงู",
                            price: 1299.99,
                            originalPrice: 1499.99,
                            category: "electronics",
                            status: "active",
                            image: "laptop.jpg",
                            stock: 50,
                            createdAt: new Date().toISOString()
                        },
                        {
                            name: "ุขูููู 15 ุจุฑู",
                            description: "ุขูููู 15 ุจุฑู ุจูุงููุฑุง ูุชุทูุฑุฉ ูุดุงุดุฉ Super Retina XDR",
                            price: 999.99,
                            originalPrice: 1199.99,
                            category: "electronics",
                            status: "active",
                            image: "iphone.jpg",
                            stock: 100,
                            createdAt: new Date().toISOString()
                        },
                        {
                            name: "ุณุงุนุฉ ุขุจู ูุงุชุด",
                            description: "ุณุงุนุฉ ุขุจู ูุงุชุด Series 8 ุจููุงุณ ุงูุฃูุณุฌูู ูู ุงูุฏู",
                            price: 399.99,
                            originalPrice: 449.99,
                            category: "electronics",
                            status: "active",
                            image: "watch.jpg",
                            stock: 75,
                            createdAt: new Date().toISOString()
                        },
                        {
                            name: "ุณูุงุนุงุช ุณููู WH-1000XM5",
                            description: "ุณูุงุนุงุช ุณููู ุงููุงุณูููุฉ ุจุฅูุบุงุก ุงูุถุฌูุฌ",
                            price: 349.99,
                            originalPrice: 399.99,
                            category: "electronics",
                            status: "active",
                            image: "headphones.jpg",
                            stock: 60,
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    const batch = db.batch();
                    defaultProducts.forEach(product => {
                        const docRef = db.collection('main_store_products').doc();
                        batch.set(docRef, product);
                    });
                    
                    await batch.commit();
                    
                    // ุฅุนุงุฏุฉ ุชุญููู ุงูููุชุฌุงุช
                    setTimeout(() => loadMainStoreProducts(), 500);
                    return;
                }
                
                let productsHTML = '';
                
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    const productId = doc.id;
                    
                    const price = Number(product.price) || 0;
                    const originalPrice = Number(product.originalPrice) || price * 1.2;
                    const discount = originalPrice > price ? 
                        Math.round(((originalPrice - price) / originalPrice) * 100) : 0;
                    
                    productsHTML += `
                        <div class="store-card bg-white rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6">
                                ${discount > 0 ? `
                                    <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm">
                                        ${discount}% ุฎุตู
                                    </div>
                                ` : ''}
                                
                                <h3 class="text-xl font-bold text-dark mb-2">${product.name}</h3>
                                <p class="text-gray-600 text-sm mb-4">${product.description || 'ููุชุฌ ูู ูุชุฌุฑ ุงูููุตุฉ ุงูุฑุฆูุณู'}</p>
                                
                                <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-gray-700">ุงูุณุนุฑ:</span>
                                        <div class="text-right">
                                            <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                            ${originalPrice > price ? `
                                                <span class="text-sm text-gray-500 line-through mr-2 block">$${originalPrice.toFixed(2)}</span>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center mt-3">
                                        <span class="text-gray-700">ุงููุชููุฑ:</span>
                                        <span class="text-sm ${product.stock > 10 ? 'text-green-600' : 'text-red-600'}">
                                            ${product.stock || 0} ูุทุนุฉ
                                        </span>
                                    </div>
                                </div>
                                
                                <button onclick="purchaseFromMainStore('${productId}', '${product.name}', ${price})" 
                                        class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-shopping-cart ml-2"></i>
                                    ุดุฑุงุก ุงูุขู
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = productsHTML;
            } catch (error) {
                console.error('Error loading main store products:', error);
                container.innerHTML = `
                    <div class="md:col-span-4 text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-gray-500">ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ููุชุฌุงุช ุงููุชุฌุฑ ุงูุฑุฆูุณู</p>
                    </div>
                `;
            }
        }

        async function purchaseFromMainStore(productId, productName, price) {
            if (!currentUser) {
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                showLoginModal();
                return;
            }
            
            try {
                // ุญูุธ ุนูููุฉ ุงูุดุฑุงุก ูู ุงููุชุฌุฑ ุงูุฑุฆูุณู
                const purchaseRef = await db.collection('main_store_purchases').add({
                    userId: currentUser.uid,
                    productId: productId,
                    productName: productName,
                    price: price,
                    purchaseDate: new Date().toISOString(),
                    status: 'completed',
                    paymentMethod: 'simulated'
                });
                
                // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
                await db.collection('users').doc(currentUser.uid).update({
                    totalPurchases: firebase.firestore.FieldValue.increment(1)
                });
                
                // ุชุญุฏูุซ ุงููุฎุฒูู
                const productDoc = await db.collection('main_store_products').doc(productId).get();
                const currentStock = productDoc.data().stock || 0;
                
                if (currentStock > 0) {
                    await db.collection('main_store_products').doc(productId).update({
                        stock: firebase.firestore.FieldValue.increment(-1)
                    });
                }
                
                // ุญูุธ ุณุฌู ุงูุนูููุฉ
                await db.collection('purchase_logs').add({
                    purchaseId: purchaseRef.id,
                    storeId: 'main_store',
                    userId: currentUser.uid,
                    productName: productName,
                    price: price,
                    timestamp: new Date().toISOString(),
                    type: 'main_store'
                });
                
                showToast(`ุชูุช ุนูููุฉ ุงูุดุฑุงุก ุจูุฌุงุญ! ${productName} - $${price.toFixed(2)}`, 'success');
                
            } catch (error) {
                console.error('Error purchasing from main store:', error);
                showError('ุฎุทุฃ ูู ุนูููุฉ ุงูุดุฑุงุก: ' + error.message);
            }
        }

        async function showStoreDetailsModal(storeId) {
            currentStoreId = storeId;
            closeAllModals();
            document.getElementById('storeDetailsModal').classList.remove('hidden');
            document.getElementById('storeDetailsModal').classList.add('flex');
            loadStoreDetails(storeId);
        }

        async function showStorePage(storeId) {
            currentStoreId = storeId;
            closeAllModals();
            document.getElementById('storePageModal').classList.remove('hidden');
            document.getElementById('storePageModal').classList.add('flex');
            loadStorePage(storeId);
        }

        async function loadStoreDetails(storeId) {
            const content = document.getElementById('storeDetailsContent');
            const title = document.getElementById('storeDetailsTitle');
            
            try {
                const storeDoc = await db.collection('stores').doc(storeId).get();
                
                if (!storeDoc.exists) {
                    content.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                            <p class="text-gray-500">ุงููุชุฌุฑ ุบูุฑ ููุฌูุฏ</p>
                        </div>
                    `;
                    return;
                }
                
                const store = storeDoc.data();
                title.textContent = store.name;
                
                // ุชุญููู ููุชุฌุงุช ุงููุชุฌุฑ
                const productsSnapshot = await db.collection('store_products')
                    .where('storeId', '==', storeId)
                    .get();
                
                let productsHTML = '';
                if (!productsSnapshot.empty) {
                    productsSnapshot.forEach(doc => {
                        const product = doc.data();
                        productsHTML += `
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-3 px-4">${product.productName}</td>
                                <td class="py-3 px-4">$${product.productPrice?.toFixed(2) || '0.00'}</td>
                                <td class="py-3 px-4 text-green-600">+$${product.expectedProfit?.toFixed(2) || '0.00'}</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 rounded text-sm ${product.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${product.status === 'active' ? 'ูุดุท' : 'ุบูุฑ ูุดุท'}
                                    </span>
                                </td>
                            </tr>
                        `;
                    });
                } else {
                    productsHTML = `
                        <tr>
                            <td colspan="4" class="py-8 text-center text-gray-500">
                                <i class="fas fa-box text-2xl mb-2"></i>
                                <p>ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ูุฐุง ุงููุชุฌุฑ ุจุนุฏ</p>
                            </td>
                        </tr>
                    `;
                }
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-2">ูุนูููุงุช ุงููุชุฌุฑ</h4>
                                    <p><strong>ุงูุงุณู:</strong> ${store.name}</p>
                                    <p><strong>ุงููุฆุฉ:</strong> ${getCategoryName(store.category)}</p>
                                    <p><strong>ุงููุตู:</strong> ${store.description || 'ูุง ููุฌุฏ ูุตู'}</p>
                                    <p><strong>ุงููุงูู:</strong> ${store.ownerName} (${store.ownerEmail})</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-2">ุฅุญุตุงุฆูุงุช</h4>
                                    <p><strong>ุนุฏุฏ ุงูููุชุฌุงุช:</strong> ${store.productsCount || 0}</p>
                                    <p><strong>ุนุฏุฏ ุงููุจูุนุงุช:</strong> ${store.salesCount || 0}</p>
                                    <p><strong>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช:</strong> $${store.totalRevenue?.toFixed(2) || '0.00'}</p>
                                    <p><strong>ุงูุชูููู:</strong> ${store.rating || 0} โญ</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h4 class="font-bold text-gray-700 mb-2">ุฑุงุจุท ุงููุชุฌุฑ</h4>
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <input type="text" value="${store.storeUrl || `${window.location.origin}/store/${storeId}`}" 
                                           class="flex-1 px-3 py-2 border rounded-lg bg-gray-100" readonly>
                                    <button onclick="copyStoreLink('${store.storeUrl || `${window.location.origin}/store/${storeId}`}')" 
                                            class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-xl font-bold text-dark mb-4">ููุชุฌุงุช ุงููุชุฌุฑ</h4>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="py-3 px-4 text-right">ุงุณู ุงูููุชุฌ</th>
                                            <th class="py-3 px-4 text-right">ุงูุณุนุฑ</th>
                                            <th class="py-3 px-4 text-right">ุงูุฑุจุญ ุงููุชููุน</th>
                                            <th class="py-3 px-4 text-right">ุงูุญุงูุฉ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${productsHTML}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="flex justify-between pt-6 border-t">
                            <button onclick="deleteStore('${storeId}')" 
                                    class="bg-red-100 text-red-600 px-6 py-2 rounded-lg hover:bg-red-200 transition-colors">
                                <i class="fas fa-trash ml-2"></i>
                                ุญุฐู ุงููุชุฌุฑ
                            </button>
                            <div class="space-x-2 space-x-reverse">
                                <button onclick="showStorePage('${storeId}')"
                                        class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-external-link-alt ml-2"></i>
                                    ุฒูุงุฑุฉ ุงููุชุฌุฑ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading store details:', error);
                content.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-gray-500">ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุชูุงุตูู ุงููุชุฌุฑ</p>
                    </div>
                `;
            }
        }

        async function loadStorePage(storeId) {
            const content = document.getElementById('storePageContent');
            const title = document.getElementById('storePageTitle');
            
            try {
                const storeDoc = await db.collection('stores').doc(storeId).get();
                
                if (!storeDoc.exists) {
                    content.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                            <p class="text-gray-500">ุงููุชุฌุฑ ุบูุฑ ููุฌูุฏ</p>
                        </div>
                    `;
                    return;
                }
                
                const store = storeDoc.data();
                title.textContent = store.name;
                
                // ุชุญููู ููุชุฌุงุช ุงููุชุฌุฑ ููุนุฑุถ ูู ุตูุญุฉ ุงููุชุฌุฑ
                const productsSnapshot = await db.collection('store_products')
                    .where('storeId', '==', storeId)
                    .where('status', '==', 'active')
                    .get();
                
                let productsHTML = '';
                if (!productsSnapshot.empty) {
                    productsSnapshot.forEach(doc => {
                        const product = doc.data();
                        const price = product.productPrice || 0;
                        const originalPrice = price * 1.2;
                        
                        productsHTML += `
                            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                                <div class="p-6">
                                    <h4 class="text-lg font-bold text-dark mb-2">${product.productName}</h4>
                                    <p class="text-gray-600 text-sm mb-4">${product.productDescription || 'ููุชุฌ ุนุงูู ุงูุฌูุฏุฉ'}</p>
                                    
                                    <div class="mb-4">
                                        <div class="flex items-center mb-2">
                                            <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                            <span class="text-sm text-gray-500 line-through mr-2">$${originalPrice.toFixed(2)}</span>
                                        </div>
                                        <div class="text-sm text-green-600 mb-2">
                                            <i class="fas fa-bolt ml-1"></i>
                                            ุชูุตูู ุณุฑูุน
                                        </div>
                                    </div>
                                    
                                    <button onclick="simulatePurchase('${storeId}', '${product.productName}', ${price}, '${doc.id}')" 
                                            class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-shopping-cart ml-2"></i>
                                        ุดุฑุงุก ุงูุขู
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    productsHTML = `
                        <div class="col-span-3 text-center py-12">
                            <i class="fas fa-box text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ูุฐุง ุงููุชุฌุฑ ุญุงููุงู</p>
                            <p class="text-sm text-gray-400 mt-2">ุณูุชู ุฅุถุงูุฉ ุงูููุชุฌุงุช ูุฑูุจุงู</p>
                        </div>
                    `;
                }
                
                content.innerHTML = `
                    <div class="space-y-8">
                        <!-- Store Header -->
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-8 text-white">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                                <div>
                                    <h2 class="text-3xl font-bold mb-2">${store.name}</h2>
                                    <p class="text-blue-100">${store.description || 'ูุชุฌุฑ ุฅููุชุฑููู ูุชูุงูู'}</p>
                                </div>
                                <div class="mt-4 md:mt-0">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                                            <i class="fas fa-store text-xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm">ุงูุชูููู</div>
                                            <div class="flex">
                                                ${Array(5).fill().map((_, i) => `
                                                    <i class="fas fa-star ${i < Math.floor(store.rating || 0) ? 'text-yellow-300' : 'text-gray-300'} ml-1"></i>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Products -->
                        <div>
                            <h3 class="text-2xl font-bold text-dark mb-6">ููุชุฌุงุช ุงููุชุฌุฑ</h3>
                            ${productsSnapshot.empty ? productsHTML : `
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    ${productsHTML}
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading store page:', error);
                content.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <p class="text-gray-500">ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุตูุญุฉ ุงููุชุฌุฑ</p>
                        <button onclick="closeModal('storePageModal')" class="mt-4 bg-primary text-white px-6 py-2 rounded-lg">
                            ุงูุนูุฏุฉ
                        </button>
                    </div>
                `;
            }
        }

        async function simulatePurchase(storeId, productName, price, productDocId) {
            if (!currentUser) {
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                showLoginModal();
                return;
            }
            
            try {
                // ุญูุธ ุนูููุฉ ุงูุดุฑุงุก
                const purchaseRef = await db.collection('purchases').add({
                    userId: currentUser.uid,
                    storeId: storeId,
                    productName: productName,
                    price: price,
                    purchaseDate: new Date().toISOString(),
                    status: 'completed',
                    paymentMethod: 'simulated'
                });
                
                // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุชุฌุฑ
                await db.collection('stores').doc(storeId).update({
                    salesCount: firebase.firestore.FieldValue.increment(1),
                    totalRevenue: firebase.firestore.FieldValue.increment(price),
                    lastUpdated: new Date().toISOString()
                });
                
                // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู ุงููุดุชุฑู
                await db.collection('users').doc(currentUser.uid).update({
                    totalPurchases: firebase.firestore.FieldValue.increment(1)
                });
                
                // ุฌูุงู ูุงูู ุงููุชุฌุฑ
                const storeDoc = await db.collection('stores').doc(storeId).get();
                const storeData = storeDoc.data();
                
                if (storeData.ownerId) {
                    // ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ูุงูู ุงููุชุฌุฑ
                    await db.collection('users').doc(storeData.ownerId).update({
                        totalSales: firebase.firestore.FieldValue.increment(1)
                    });
                }
                
                // ุญูุธ ุณุฌู ุงูุนูููุฉ
                await db.collection('purchase_logs').add({
                    purchaseId: purchaseRef.id,
                    storeId: storeId,
                    userId: currentUser.uid,
                    productName: productName,
                    price: price,
                    timestamp: new Date().toISOString(),
                    ownerId: storeData.ownerId
                });
                
                showToast(`ุชูุช ุนูููุฉ ุงูุดุฑุงุก ุจูุฌุงุญ! ${productName} - $${price.toFixed(2)}`, 'success');
                
                // ุฅุบูุงู ุตูุญุฉ ุงููุชุฌุฑ ุจุนุฏ ุซุงููุชูู
                setTimeout(() => {
                    closeModal('storePageModal');
                }, 2000);
                
            } catch (error) {
                console.error('Error simulating purchase:', error);
                showError('ุฎุทุฃ ูู ุนูููุฉ ุงูุดุฑุงุก: ' + error.message);
            }
        }

        async function deleteStore(storeId) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุชุฌุฑุ ุณูุชู ุญุฐู ุฌููุน ุงูููุชุฌุงุช ุงููุฑุชุจุทุฉ ุจู.')) {
                return;
            }
            
            try {
                showToast('ุฌุงุฑู ุญุฐู ุงููุชุฌุฑ...');
                
                // ุชุญุฏูุซ ุญุงูุฉ ุงููุชุฌุฑ ุจุฏูุงู ูู ุญุฐูู
                await db.collection('stores').doc(storeId).update({
                    isActive: false,
                    deletedAt: new Date().toISOString(),
                    status: 'deleted'
                });
                
                // ุญูุธ ุณุฌู ุงูุญุฐู
                await db.collection('store_logs').add({
                    storeId: storeId,
                    action: 'delete',
                    userId: currentUser.uid,
                    timestamp: new Date().toISOString()
                });
                
                // ุชุญุฏูุซ ุนุฏุฏ ูุชุงุฌุฑ ุงููุณุชุฎุฏู
                await db.collection('users').doc(currentUser.uid).update({
                    storesCount: firebase.firestore.FieldValue.increment(-1)
                });
                
                showToast('ุชู ุญุฐู ุงููุชุฌุฑ ุจูุฌุงุญ', 'success');
                
                // ุฅุบูุงู ูุงูุฐุฉ ุงูุชูุงุตูู
                closeModal('storeDetailsModal');
                
                // ุฅุนุงุฏุฉ ุชุญููู ุงููุชุงุฌุฑ
                setTimeout(() => {
                    loadStores();
                }, 500);
                
            } catch (error) {
                console.error('Error deleting store:', error);
                showError('ุฎุทุฃ ูู ุญุฐู ุงููุชุฌุฑ: ' + error.message);
            }
        }

        // Account Settings Functions
        async function loadAccountSettings() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                document.getElementById('settingsName').value = userData.name || '';
                document.getElementById('settingsEmail').value = userData.email || '';
                
                // ุชุญุฏูุฏ ููุน ุงูุญุณุงุจ
                const accountType = userData.accountType || 'buyer';
                const radio = document.querySelector(`input[name="settingsAccountType"][value="${accountType}"]`);
                if (radio) {
                    radio.checked = true;
                }
                
            } catch (error) {
                console.error('Error loading account settings:', error);
                showError('ุฎุทุฃ ูู ุชุญููู ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ');
            }
        }

        async function updateAccountSettings(event) {
            event.preventDefault();
            
            try {
                const name = document.getElementById('settingsName').value;
                const accountType = document.querySelector('input[name="settingsAccountType"]:checked').value;
                const newPassword = document.getElementById('settingsNewPassword').value;
                const confirmPassword = document.getElementById('settingsConfirmPassword').value;
                
                // ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ ุฅุฐุง ุชู ุฅุฏุฎุงููุง
                if (newPassword && newPassword !== confirmPassword) {
                    showError('ูููุฉ ุงููุฑูุฑ ูุชุฃููุฏูุง ุบูุฑ ูุชุทุงุจููู');
                    return;
                }
                
                showToast('ุฌุงุฑู ุชุญุฏูุซ ุงูุญุณุงุจ...');
                
                // ุชุญุฏูุซ ุงุณู ุงูุนุฑุถ ูู Firebase Auth
                if (name !== currentUser.displayName) {
                    await currentUser.updateProfile({ displayName: name });
                }
                
                // ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุฅุฐุง ุชู ุฅุฏุฎุงููุง
                if (newPassword) {
                    await currentUser.updatePassword(newPassword);
                }
                
                // ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
                const updateData = {
                    name: name,
                    accountType: accountType,
                    role: accountType === 'seller' ? 'seller' : 'buyer',
                    maxStores: accountType === 'seller' ? 1 : 0,
                    updatedAt: new Date().toISOString()
                };
                
                await db.collection('users').doc(currentUser.uid).update(updateData);
                
                // ุญูุธ ุณุฌู ุงูุชุญุฏูุซ
                await db.collection('user_logs').add({
                    userId: currentUser.uid,
                    action: 'update_settings',
                    timestamp: new Date().toISOString(),
                    details: {
                        accountType: accountType,
                        name: name
                    }
                });
                
                // ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู ุงูุญุงูู
                currentUserRole = accountType === 'seller' ? 'seller' : 'buyer';
                currentUserAccountType = accountType;
                
                showToast('ุชู ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ ุจูุฌุงุญ', 'success');
                closeModal('accountSettingsModal');
                updateUIAfterLogin();
                
                // ุฅุนุงุฏุฉ ุชุญููู ุงููุญุชูู ุญุณุจ ุงูุฏูุฑ ุงูุฌุฏูุฏ
                showContentBasedOnRole();
                
            } catch (error) {
                console.error('Error updating account settings:', error);
                showError('ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุญุณุงุจ: ' + error.message);
            }
        }

        async function checkUserPlanAndCreateStore() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                // ุนุฏุฏ ุงููุชุงุฌุฑ ุงููุณููุญ ุจูุง ุญุณุจ ุงูุจุงูุฉ
                let maxStores = 0;
                if (userData.plan === 'basic') {
                    maxStores = 1;
                } else if (userData.plan === 'premium') {
                    maxStores = 5;
                } else {
                    maxStores = 1; // ุงูุจุงูุฉ ุงููุฌุงููุฉ
                }
                
                // ุญุณุงุจ ุนุฏุฏ ุงููุชุงุฌุฑ ุงูุญุงููุฉ
                const storesSnapshot = await db.collection('stores')
                    .where('ownerId', '==', currentUser.uid)
                    .where('isActive', '==', true)
                    .get();
                
                if (storesSnapshot.size >= maxStores) {
                    if (userData.plan === 'free' || userData.plan === 'basic') {
                        showError(`ููุฏ ูุตูุช ููุญุฏ ุงูุฃูุตู ูููุชุงุฌุฑ (${maxStores}) ูู ุจุงูุงุชู ุงูุญุงููุฉ`);
                        setTimeout(() => {
                            navigateTo('plans');
                        }, 2000);
                    } else {
                        showError('ููุฏ ูุตูุช ููุญุฏ ุงูุฃูุตู ูููุชุงุฌุฑ ูู ุจุงูุงุชู');
                    }
                    return;
                }
                
                // ุฅุฐุง ูุงู ุงููุณููุญ ููุ ููุชุญ ูุงูุฐุฉ ุฅูุดุงุก ุงููุชุฌุฑ
                closeAllModals();
                document.getElementById('createStoreModal').classList.remove('hidden');
                document.getElementById('createStoreModal').classList.add('flex');
                
            } catch (error) {
                console.error('Error checking user plan:', error);
                showError('ุฎุทุฃ ูู ุงูุชุญูู ูู ุงูุจุงูุฉ');
            }
        }

        // ูุธุงุฆู ุงูุจุงูุงุช
        async function subscribeToPlan(planType) {
            if (!currentUser) {
                showLoginModal();
                showError('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                return;
            }
            
            if (currentUserAccountType !== 'seller') {
                showError('ูุฐู ุงูููุฒุฉ ูุชุงุญุฉ ููุท ููุจุงุฆุนูู');
                return;
            }
            
            try {
                showToast('ุฌุงุฑู ุชูุนูู ุงูุจุงูุฉ...');
                
                const planConfig = {
                    'basic': {
                        price: 3,
                        maxStores: 1,
                        maxProducts: 99999,
                        commissionRate: 0.15,
                        features: ['ูุชุฌุฑ ูุงุญุฏ', 'ููุชุฌุงุช ุบูุฑ ูุญุฏูุฏุฉ', 'ุฏุนู ููู ุนุจุฑ ุงูุจุฑูุฏ', 'ุชูุงุฑูุฑ ุฃุณุงุณูุฉ']
                    },
                    'premium': {
                        price: 15,
                        maxStores: 5,
                        maxProducts: 99999,
                        commissionRate: 0.10,
                        features: ['5 ูุชุงุฌุฑ', 'ููุชุฌุงุช ุบูุฑ ูุญุฏูุฏุฉ', 'ุฏุนู ููู ููุฑู', 'ุชูุงุฑูุฑ ูุชูุฏูุฉ', 'ูุทุงู ูุฎุตุต']
                    }
                };
                
                const plan = planConfig[planType];
                if (!plan) {
                    showError('ุงูุจุงูุฉ ุบูุฑ ููุฌูุฏุฉ');
                    return;
                }
                
                // ุญุณุงุจ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุงุดุชุฑุงู (30 ููู ูู ุงูุขู)
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + 30);
                
                await db.collection('users').doc(currentUser.uid).update({
                    plan: planType,
                    maxStores: plan.maxStores,
                    maxProducts: plan.maxProducts,
                    commissionRate: plan.commissionRate,
                    subscriptionExpiry: expiryDate.toISOString(),
                    subscribedAt: new Date().toISOString()
                });
                
                // ุญูุธ ุณุฌู ุงูุงุดุชุฑุงู
                await db.collection('subscription_logs').add({
                    userId: currentUser.uid,
                    plan: planType,
                    price: plan.price,
                    subscribedAt: new Date().toISOString(),
                    expiryDate: expiryDate.toISOString()
                });
                
                showToast(`ุชู ุชูุนูู ุงูุจุงูุฉ ${planType === 'basic' ? 'ุงูุฃุณุงุณูุฉ' : 'ุงููููุฒุฉ'} ุจูุฌุงุญ!`, 'success');
                
            } catch (error) {
                console.error('Error subscribing to plan:', error);
                showError('ุฎุทุฃ ูู ุชูุนูู ุงูุจุงูุฉ');
            }
        }

        // Helper functions
        function generateStoreSlug(storeName) {
            // ุชุญููู ุงูุงุณู ุฅูู slug
            return storeName
                .toLowerCase()
                .replace(/[^a-z0-9\u0600-\u06FF\s]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim()
                + '-' + Math.random().toString(36).substr(2, 9);
        }

        function copyStoreLink(url) {
            navigator.clipboard.writeText(url)
                .then(() => {
                    showToast('ุชู ูุณุฎ ุงูุฑุงุจุท', 'success');
                })
                .catch(() => {
                    showError('ูุดู ูุณุฎ ุงูุฑุงุจุท');
                });
        }

        function getCategoryName(category) {
            const categories = {
                'electronics': 'ุฅููุชุฑูููุงุช',
                'clothing': 'ููุงุจุณ',
                'home': 'ููุฒููุฉ',
                'books': 'ูุชุจ',
                'sports': 'ุฑูุงุถูุฉ'
            };
            return categories[category] || category;
        }

        function getFirebaseErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-email': 'ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ุตุงูุญ',
                'auth/user-disabled': 'ูุฐุง ุงูุญุณุงุจ ูุนุทู',
                'auth/user-not-found': 'ูุง ููุฌุฏ ุญุณุงุจ ุจูุฐุง ุงูุจุฑูุฏ',
                'auth/wrong-password': 'ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ',
                'auth/email-already-in-use': 'ูุฐุง ุงูุจุฑูุฏ ูุณุฌู ุจุงููุนู',
                'auth/weak-password': 'ูููุฉ ุงููุฑูุฑ ุถุนููุฉ ุฌุฏุงู',
                'auth/network-request-failed': 'ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช',
                'firestore/permission-denied': 'ุฎุทุฃ ูู ุงูุตูุงุญูุงุช',
                'auth/requires-recent-login': 'ูุฌุจ ุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู ูุฅุฌุฑุงุก ูุฐู ุงูุนูููุฉ'
            };
            return messages[errorCode] || 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุนุฑูู: ' + errorCode;
        }

        // UI Update functions
        function updateUIAfterLogin() {
            const authButtons = document.getElementById('authButtons');
            const user = auth.currentUser;
            
            let userBadge = '';
            if (currentUserRole === 'admin') {
                userBadge = '<span class="admin-badge text-white text-xs px-2 py-1 rounded-full mr-2">ูุฏูุฑ</span>';
            } else if (currentUserAccountType === 'seller') {
                userBadge = '<span class="seller-badge text-white text-xs px-2 py-1 rounded-full mr-2">ุจุงุฆุน</span>';
            } else {
                userBadge = '<span class="buyer-badge text-white text-xs px-2 py-1 rounded-full mr-2">ูุดุชุฑู</span>';
            }
            
            authButtons.innerHTML = `
                <div class="flex items-center space-x-4 space-x-reverse">
                    ${currentUserRole === 'admin' ? `
                        <button onclick="showAdminPanelModal()" class="bg-accent text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition-colors">
                            <i class="fas fa-cogs ml-2"></i>
                            ููุญุฉ ุงูุฅุฏุงุฑุฉ
                        </button>
                    ` : ''}
                    
                    ${currentUserAccountType === 'seller' ? `
                        <button onclick="showUserDashboard()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-store ml-2"></i>
                            ูุชุงุฌุฑู
                        </button>
                    ` : ''}
                    
                    <button onclick="showAccountSettingsModal()" class="border border-gray-300 text-dark px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                        ${userBadge}
                        <i class="fas fa-user ml-2"></i>
                        ${user.displayName || user.email.split('@')[0]}
                    </button>
                    
                    <button onclick="logout()" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors">
                        <i class="fas fa-sign-out-alt ml-2"></i>
                        ุชุณุฌูู ุงูุฎุฑูุฌ
                    </button>
                </div>
            `;
        }

        function updateUIAfterLogout() {
            const authButtons = document.getElementById('authButtons');
            
            authButtons.innerHTML = `
                <button onclick="showLoginModal()" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <button onclick="showRegisterModal()" class="border border-primary text-primary px-6 py-2 rounded-lg hover:bg-primary hover:text-white transition-colors">
                    <i class="fas fa-user-plus ml-2"></i>
                    ุฅูุดุงุก ุญุณุงุจ
                </button>
            `;
        }

        function showContentForGuest() {
            // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ูุฅุธูุงุฑ ุงูุฑุฆูุณูุฉ ููุท
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('home').classList.remove('hidden');
            document.getElementById('features').classList.remove('hidden');
            
            // ุฅุฎูุงุก ุฃูุณุงู ุงููุชุงุฌุฑ ูุงูููุชุฌุงุช ูู ุงููุงุฆูุฉ
            updateNavForGuest();
        }

        function updateNavForGuest() {
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                if (link.textContent.includes('ุงููุชุงุฌุฑ') || link.textContent.includes('ุงูููุชุฌุงุช')) {
                    link.style.display = 'none';
                } else {
                    link.style.display = 'block';
                }
            });
        }

        function updateNavForUser() {
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.style.display = 'block';
            });
        }

        function showContentBasedOnRole() {
            event?.preventDefault();
            
            // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ุฃููุงู
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            
            if (!currentUser) {
                showContentForGuest();
                return;
            }
            
            // ุชุญุฏูุซ ุงููุงุฆูุฉ
            updateNavForUser();
            
            if (currentUserRole === 'admin') {
                // ูููุฏูุฑ: ุฅุธูุงุฑ ุฌููุน ุงูุฃูุณุงู
                document.getElementById('home').classList.remove('hidden');
                document.getElementById('features').classList.remove('hidden');
                document.getElementById('stores').classList.remove('hidden');
                document.getElementById('products').classList.remove('hidden');
                document.getElementById('plans').classList.remove('hidden');
                document.getElementById('mainStore').classList.remove('hidden');
                
                // ุชุญููู ุงููุญุชูู
                loadStores();
                loadProducts();
                loadMainStoreProducts();
                
            } else if (currentUserAccountType === 'seller') {
                // ููุจุงุฆุน: ุฅุธูุงุฑ ุงููุชุงุฌุฑ ูุงูููุชุฌุงุช ูุงูุจุงูุงุช
                document.getElementById('home').classList.remove('hidden');
                document.getElementById('features').classList.remove('hidden');
                document.getElementById('stores').classList.remove('hidden');
                document.getElementById('products').classList.remove('hidden');
                document.getElementById('plans').classList.remove('hidden');
                document.getElementById('mainStore').classList.remove('hidden');
                
                // ุชุญููู ุงููุญุชูู ููุจุงุฆุน
                loadStores();
                loadProducts();
                loadMainStoreProducts();
                
            } else if (currentUserAccountType === 'buyer') {
                // ูููุดุชุฑู: ุฅุธูุงุฑ ูุชุฌุฑ ุงูููุตุฉ ูุงูุจุงูุงุช ููุท
                document.getElementById('home').classList.remove('hidden');
                document.getElementById('features').classList.remove('hidden');
                document.getElementById('plans').classList.remove('hidden');
                document.getElementById('mainStore').classList.remove('hidden');
                
                // ุชุญููู ููุชุฌุงุช ุงููุชุฌุฑ ุงูุฑุฆูุณู
                loadMainStoreProducts();
            }
        }

        async function showUserDashboard() {
            if (!currentUser) {
                showLoginModal();
                return;
            }
            
            if (currentUserAccountType !== 'seller') {
                showError('ูุฐู ุงูููุฒุฉ ูุชุงุญุฉ ููุท ููุจุงุฆุนูู');
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                const storesSnapshot = await db.collection('stores')
                    .where('ownerId', '==', currentUser.uid)
                    .where('isActive', '==', true)
                    .get();
                
                const userStores = [];
                storesSnapshot.forEach(doc => {
                    userStores.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                const storeProducts = [];
                for (const store of userStores) {
                    const productsSnapshot = await db.collection('store_products')
                        .where('storeId', '==', store.id)
                        .get();
                    
                    productsSnapshot.forEach(doc => {
                        storeProducts.push({
                            storeId: store.id,
                            storeName: store.name,
                            ...doc.data()
                        });
                    });
                }
                
                // ุญุณุงุจ ุฅุฌูุงูู ุงูุฃุฑุจุงุญ ุงููุชููุนุฉ
                const totalExpectedProfit = storeProducts.reduce((total, product) => {
                    return total + (product.expectedProfit || 0);
                }, 0);
                
                const dashboardHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                            <div class="p-8">
                                <div class="flex justify-between items-center mb-8">
                                    <div>
                                        <h2 class="text-2xl font-bold text-dark">ููุญุฉ ุชุญููู</h2>
                                        <p class="text-gray-600">ูุฑุญุจุงู ${userData.name || currentUser.email.split('@')[0]}!</p>
                                        <div class="mt-2">
                                            <span class="px-3 py-1 rounded-full text-sm ${userData.plan === 'premium' ? 'premium-badge text-white' : userData.plan === 'basic' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                                                ${userData.plan === 'premium' ? 'ุจุงูุฉ ูููุฒุฉ' : userData.plan === 'basic' ? 'ุจุงูุฉ ุฃุณุงุณูุฉ' : 'ุจุงูุฉ ูุฌุงููุฉ'}
                                            </span>
                                            ${userData.subscriptionExpiry ? `
                                                <span class="text-sm text-gray-500 mr-2">
                                                    ุชูุชูู ูู: ${new Date(userData.subscriptionExpiry).toLocaleDateString('ar-EG')}
                                                </span>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <button onclick="closeUserDashboard()" class="text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-times text-2xl"></i>
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                    <div class="bg-blue-50 p-4 rounded-xl">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center ml-3">
                                                <i class="fas fa-store text-blue-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-gray-500 text-sm">ุงููุชุงุฌุฑ</p>
                                                <p class="text-xl font-bold text-dark">${userStores.length}/${userData.maxStores || 1}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-green-50 p-4 rounded-xl">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center ml-3">
                                                <i class="fas fa-box text-green-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-gray-500 text-sm">ุงูููุชุฌุงุช</p>
                                                <p class="text-xl font-bold text-dark">${storeProducts.length}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-yellow-50 p-4 rounded-xl">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center ml-3">
                                                <i class="fas fa-chart-line text-yellow-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-gray-500 text-sm">ุงููุจูุนุงุช</p>
                                                <p class="text-xl font-bold text-dark">${userData.totalSales || 0}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-purple-50 p-4 rounded-xl">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center ml-3">
                                                <i class="fas fa-money-bill text-purple-600"></i>
                                            </div>
                                            <div>
                                                <p class="text-gray-500 text-sm">ุงูุฃุฑุจุงุญ ุงููุชููุนุฉ</p>
                                                <p class="text-xl font-bold text-dark">$${totalExpectedProfit.toFixed(2)}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                ${userData.plan !== 'premium' ? `
                                    <div class="mb-8 p-4 premium-badge rounded-lg text-white">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h3 class="font-bold text-lg">ุชุฑููุฉ ููุจุงูุฉ ุงููููุฒุฉ</h3>
                                                <p class="text-sm opacity-90">ุงุญุตู ุนูู 5 ูุชุงุฌุฑ ูุฃุฑุจุงุญ ุฃูุจุฑ</p>
                                            </div>
                                            <button onclick="subscribeToPlan('premium')" 
                                                    class="bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100">
                                                ุชุฑููุฉ ุงูุขู ุจู $15
                                            </button>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div class="mb-8">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-xl font-bold text-dark">ูุชุงุฌุฑู</h3>
                                        <button onclick="showCreateStoreModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                            <i class="fas fa-plus ml-2"></i>
                                            ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ
                                        </button>
                                    </div>
                                    
                                    ${userStores.length > 0 ? `
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            ${userStores.map(store => `
                                                <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="font-bold text-dark text-lg">${store.name}</h4>
                                                            <p class="text-gray-600 text-sm mt-1">${store.description || 'ูุง ููุฌุฏ ูุตู'}</p>
                                                        </div>
                                                        <div class="flex space-x-2 space-x-reverse">
                                                            <button onclick="showStorePage('${store.id}')" 
                                                                    class="text-green-600 hover:text-green-800" 
                                                                    title="ุฒูุงุฑุฉ ุงููุชุฌุฑ">
                                                                <i class="fas fa-external-link-alt"></i>
                                                            </button>
                                                            <button onclick="showStoreDetailsModal('${store.id}')" 
                                                                    class="text-primary hover:text-blue-700" 
                                                                    title="ุชูุงุตูู ุงููุชุฌุฑ">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                            <button onclick="deleteStore('${store.id}')" 
                                                                    class="text-red-600 hover:text-red-800" 
                                                                    title="ุญุฐู ุงููุชุฌุฑ">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="flex justify-between text-sm mb-3">
                                                        <span class="text-gray-500">ุงูููุชุฌุงุช: ${store.productsCount || 0}</span>
                                                        <span class="text-gray-500">ุงููุจูุนุงุช: ${store.salesCount || 0}</span>
                                                    </div>
                                                    <div class="text-center">
                                                        <button onclick="showStorePage('${store.id}')" 
                                                                class="text-sm text-primary hover:underline">
                                                            ุนุฑุถ ุตูุญุฉ ุงููุชุฌุฑ
                                                        </button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : `
                                        <div class="text-center py-8 bg-gray-50 rounded-lg">
                                            <i class="fas fa-store text-4xl text-gray-300 mb-4"></i>
                                            <p class="text-gray-500">ููุณ ูุฏูู ูุชุงุฌุฑ ุจุนุฏ</p>
                                            <button onclick="showCreateStoreModal()" class="mt-4 bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                                ุฃูุดุฆ ูุชุฌุฑู ุงูุฃูู
                                            </button>
                                        </div>
                                    `}
                                </div>
                                
                                ${storeProducts.length > 0 ? `
                                    <div>
                                        <h3 class="text-xl font-bold text-dark mb-4">ููุชุฌุงุชู</h3>
                                        <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                                            <div class="overflow-x-auto">
                                                <table class="w-full">
                                                    <thead class="bg-gray-50">
                                                        <tr>
                                                            <th class="text-right py-3 px-4">ุงูููุชุฌ</th>
                                                            <th class="text-right py-3 px-4">ุงููุชุฌุฑ</th>
                                                            <th class="text-right py-3 px-4">ุงูุณุนุฑ</th>
                                                            <th class="text-right py-3 px-4">ุงูุฑุจุญ ุงููุชููุน</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${storeProducts.map((product, index) => `
                                                            <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} border-b hover:bg-gray-100">
                                                                <td class="py-3 px-4">${product.productName || 'ููุชุฌ ุจุฏูู ุงุณู'}</td>
                                                                <td class="py-3 px-4">${product.storeName || 'ูุชุฌุฑ ุบูุฑ ูุนุฑูู'}</td>
                                                                <td class="py-3 px-4">$${product.productPrice?.toFixed(2) || '0.00'}</td>
                                                                <td class="py-3 px-4 text-green-600 font-bold">+$${product.expectedProfit?.toFixed(2) || '0.00'}</td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                const dashboardElement = document.createElement('div');
                dashboardElement.innerHTML = dashboardHTML;
                dashboardElement.id = 'userDashboard';
                document.body.appendChild(dashboardElement);
                
            } catch (error) {
                console.error('Error loading user dashboard:', error);
                showError('ุฎุทุฃ ูู ุชุญููู ููุญุฉ ุงูุชุญูู: ' + error.message);
            }
        }

        function closeUserDashboard() {
            const dashboard = document.getElementById('userDashboard');
            if (dashboard) {
                dashboard.remove();
            }
        }

        // Toast functions
        function showToast(message, type = 'success') {
            if (type === 'success') {
                const toast = document.getElementById('successToast');
                document.getElementById('toastMessage').textContent = message;
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.add('hidden'), 3000);
            } else {
                showError(message);
            }
        }

        function showError(message) {
            const errorToast = document.getElementById('errorToast');
            document.getElementById('errorMessage').textContent = message;
            errorToast.classList.remove('hidden');
            setTimeout(() => errorToast.classList.add('hidden'), 3000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ูุฅุธูุงุฑ ุงูุฑุฆูุณูุฉ ููุท
            showContentForGuest();
            
            // ุฅุถุงูุฉ ูุนุงูุฌุงุช ุงูููุงุฐุฌ
            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('registerForm').addEventListener('submit', register);
            document.getElementById('createStoreForm').addEventListener('submit', createStore);
            document.getElementById('accountSettingsForm').addEventListener('submit', updateAccountSettings);
            
            // ุงูุจุญุซ ูู ุงูููุชุฌุงุช
            document.getElementById('searchProducts')?.addEventListener('input', async function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length < 2) {
                    loadProducts();
                    return;
                }
                
                try {
                    const querySnapshot = await db.collection('products')
                        .where('status', '==', 'active')
                        .get();
                    
                    const container = document.getElementById('productsContainer');
                    let productsHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const product = doc.data();
                        const productId = doc.id;
                        
                        if (product.name.toLowerCase().includes(searchTerm) || 
                            (product.description && product.description.toLowerCase().includes(searchTerm))) {
                            
                            const price = Number(product.price) || 0;
                            const originalPrice = Number(product.originalPrice) || price * 1.2;
                            const expectedProfit = price * 0.2;
                            
                            productsHTML += `
                                <div class="store-card bg-white rounded-xl shadow-lg overflow-hidden">
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold text-dark mb-2">${product.name}</h3>
                                        <p class="text-gray-600 text-sm mb-4">${product.description || 'ููุชุฌ ุนุงูู ุงูุฌูุฏุฉ'}</p>
                                        
                                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">ุงูุณุนุฑ:</span>
                                                <div class="text-right">
                                                    <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                                    <span class="text-sm text-gray-500 line-through mr-2 block">$${originalPrice.toFixed(2)}</span>
                                                </div>
                                            </div>
                                            <div class="flex justify-between items-center mt-3">
                                                <span class="text-gray-700">ุงูุฑุจุญ ุงููุชููุน:</span>
                                                <span class="text-lg font-bold text-green-600">+$${expectedProfit.toFixed(2)}</span>
                                            </div>
                                        </div>
                                        
                                        ${currentUser && currentUserAccountType === 'seller' ? `
                                            <button onclick="addToStore('${productId}')" 
                                                    class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                                <i class="fas fa-plus ml-2"></i>
                                                ุฃุถู ููุชุฌุฑู
                                            </button>
                                        ` : `
                                            <button onclick="showLoginModal()" 
                                                    class="w-full border border-primary text-primary py-3 rounded-lg hover:bg-primary hover:text-white transition-colors">
                                                <i class="fas fa-sign-in-alt ml-2"></i>
                                                ุณุฌู ุงูุฏุฎูู ููุฅุถุงูุฉ
                                            </button>
                                        `}
                                    </div>
                                </div>
                            `;
                        }
                    });
                    
                    if (productsHTML === '') {
                        productsHTML = `
                            <div class="md:col-span-4 text-center py-12">
                                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุจุญุซ</p>
                            </div>
                        `;
                    }
                    
                    container.innerHTML = productsHTML;
                    
                } catch (error) {
                    console.error('Search error:', error);
                    showError('ุฎุทุฃ ูู ุงูุจุญุซ');
                }
            });
            
            // ุงูุจุญุซ ูู ูุชุฌุฑ ุงูููุตุฉ
            document.getElementById('searchMainStoreProducts')?.addEventListener('input', async function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length < 2) {
                    loadMainStoreProducts();
                    return;
                }
                
                try {
                    const querySnapshot = await db.collection('main_store_products')
                        .where('status', '==', 'active')
                        .get();
                    
                    const container = document.getElementById('mainStoreProductsContainer');
                    let productsHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const product = doc.data();
                        const productId = doc.id;
                        
                        if (product.name.toLowerCase().includes(searchTerm) || 
                            (product.description && product.description.toLowerCase().includes(searchTerm))) {
                            
                            const price = Number(product.price) || 0;
                            const originalPrice = Number(product.originalPrice) || price * 1.2;
                            const discount = originalPrice > price ? 
                                Math.round(((originalPrice - price) / originalPrice) * 100) : 0;
                            
                            productsHTML += `
                                <div class="store-card bg-white rounded-xl shadow-lg overflow-hidden">
                                    <div class="p-6">
                                        ${discount > 0 ? `
                                            <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm">
                                                ${discount}% ุฎุตู
                                            </div>
                                        ` : ''}
                                        
                                        <h3 class="text-xl font-bold text-dark mb-2">${product.name}</h3>
                                        <p class="text-gray-600 text-sm mb-4">${product.description || 'ููุชุฌ ูู ูุชุฌุฑ ุงูููุตุฉ ุงูุฑุฆูุณู'}</p>
                                        
                                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="text-gray-700">ุงูุณุนุฑ:</span>
                                                <div class="text-right">
                                                    <span class="text-2xl font-bold text-primary">$${price.toFixed(2)}</span>
                                                    ${originalPrice > price ? `
                                                        <span class="text-sm text-gray-500 line-through mr-2 block">$${originalPrice.toFixed(2)}</span>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            <div class="flex justify-between items-center mt-3">
                                                <span class="text-gray-700">ุงููุชููุฑ:</span>
                                                <span class="text-sm ${product.stock > 10 ? 'text-green-600' : 'text-red-600'}">
                                                    ${product.stock || 0} ูุทุนุฉ
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <button onclick="purchaseFromMainStore('${productId}', '${product.name}', ${price})" 
                                                class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                            <i class="fas fa-shopping-cart ml-2"></i>
                                            ุดุฑุงุก ุงูุขู
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    
                    if (productsHTML === '') {
                        productsHTML = `
                            <div class="md:col-span-4 text-center py-12">
                                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุจุญุซ</p>
                            </div>
                        `;
                    }
                    
                    container.innerHTML = productsHTML;
                    
                } catch (error) {
                    console.error('Main store search error:', error);
                    showError('ุฎุทุฃ ูู ุงูุจุญุซ ูู ุงููุชุฌุฑ ุงูุฑุฆูุณู');
                }
            });
            
            // ุงูุชุญูู ูู ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
            if (auth) {
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUser = user;
                        
                        try {
                            const userDoc = await db.collection('users').doc(user.uid).get();
                            if (userDoc.exists) {
                                const userData = userDoc.data();
                                currentUserRole = userData.role || 'buyer';
                                currentUserAccountType = userData.accountType || 'buyer';
                                
                                // ุชุญุฏูุซ ุขุฎุฑ ููุช ุชุณุฌูู ุฏุฎูู
                                await db.collection('users').doc(user.uid).update({
                                    lastLogin: new Date().toISOString()
                                });
                                
                                // ุญูุธ ุณุฌู ุชุณุฌูู ุงูุฏุฎูู
                                await db.collection('user_logs').add({
                                    userId: user.uid,
                                    action: 'login',
                                    timestamp: new Date().toISOString()
                                });
                                
                                updateUIAfterLogin();
                                showContentBasedOnRole();
                                
                            } else {
                                // ุฅุฐุง ูู ุชูุฌุฏ ุจูุงูุงุช ุงููุณุชุฎุฏูุ ููุดุฆูุง ูู ูุดุชุฑู
                                await db.collection('users').doc(user.uid).set({
                                    name: user.displayName || user.email.split('@')[0],
                                    email: user.email,
                                    role: 'buyer',
                                    accountType: 'buyer',
                                    plan: 'free',
                                    createdAt: new Date().toISOString(),
                                    storesCount: 0,
                                    totalSales: 0,
                                    totalPurchases: 0,
                                    subscriptionExpiry: null,
                                    maxStores: 0,
                                    maxProducts: 99999,
                                    commissionRate: 0.15,
                                    emailVerified: user.emailVerified,
                                    isActive: true,
                                    lastLogin: new Date().toISOString()
                                });
                                
                                currentUserRole = 'buyer';
                                currentUserAccountType = 'buyer';
                                updateUIAfterLogin();
                                showContentBasedOnRole();
                            }
                        } catch (error) {
                            console.error('Error initializing user:', error);
                            showError('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู');
                        }
                    } else {
                        currentUser = null;
                        currentUserRole = null;
                        currentUserAccountType = null;
                        updateUIAfterLogout();
                        showContentForGuest();
                    }
                });
            }
        });
    </script>
</body>
</html>
